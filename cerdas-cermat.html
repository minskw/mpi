<!DOCTYPE html>
<html lang="id" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Show Cerdas Cermat Maulid Nabi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .arabic-text {
            font-family: 'Amiri', serif;
            font-size: 1.2em;
            line-height: 1.8;
        }
        .mixed-text {
            font-family: 'Inter', 'Amiri', sans-serif;
            line-height: 1.6;
            direction: ltr;
            text-align: left;
        }
        .arabic-only {
            font-family: 'Amiri', serif;
            line-height: 1.8;
            direction: rtl;
            text-align: right;
        }
        .question-image {
            max-width: 100%;
            max-height: 300px;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            margin: 20px auto;
            display: block;
        }
        .question-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            min-height: 160px;
            justify-content: center;
        }
        .question-text-only {
            text-align: center;
        }
        .question-with-image {
            text-align: center;
        }
        .timer-pulse {
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* Game Show Lights Animation */
        .game-show-header {
            position: relative;
            overflow: hidden;
        }
        
        .moving-lights {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 12px;
            pointer-events: none;
        }
        
        
        .light {
            position: absolute;
            width: 18px;
            height: 18px;
            background: radial-gradient(circle, #ffd700 0%, #fff8b3 60%, transparent 80%);
            box-shadow: 0 0 12px #ffd700, 0 0 20px #ffed4e;
            animation: moveLights 4s linear infinite;
            clip-path: polygon(
                50% 0%,
                61% 35%,
                98% 35%,
                68% 57%,
                79% 91%,
                50% 70%,
                21% 91%,
                32% 57%,
                2% 35%,
                39% 35%
            );
        }

        
        .light:nth-child(1) { animation-delay: 0s; }
        .light:nth-child(2) { animation-delay: 0.2s; }
        .light:nth-child(3) { animation-delay: 0.4s; }
        .light:nth-child(4) { animation-delay: 0.6s; }
        .light:nth-child(5) { animation-delay: 0.8s; }
        .light:nth-child(6) { animation-delay: 1s; }
        .light:nth-child(7) { animation-delay: 1.2s; }
        .light:nth-child(8) { animation-delay: 1.4s; }
        .light:nth-child(9) { animation-delay: 1.6s; }
        .light:nth-child(10) { animation-delay: 1.8s; }
        
        @keyframes moveLights {
            0% {
                top: 0;
                left: 0;
                transform: translateX(0);
            }
            25% {
                top: 0;
                left: 100%;
                transform: translateX(-100%);
            }
            50% {
                top: 100%;
                left: 100%;
                transform: translateX(-100%) translateY(-100%);
            }
            75% {
                top: 100%;
                left: 0;
                transform: translateY(-100%);
            }
            100% {
                top: 0;
                left: 0;
                transform: translateX(0);
            }
        }
        
        .header-glow {
            animation: headerGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes headerGlow {
            0% {
                box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
            }
            100% {
                box-shadow: 0 0 40px rgba(16, 185, 129, 0.8), 0 0 60px rgba(20, 184, 166, 0.6);
            }
        }
        :root { 
            --duration: 30; /* seconds */ 
            --border: 8px; 
        }
        
        .timer-container {
            position: relative;
            border: 8px solid #374151;
            border-radius: 12px;
        }
        
        /* Border sweep */
        .timer-border {
            position: absolute;
            inset: 0;
            border-radius: 12px;
            padding: var(--border);
            pointer-events: none;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.3s ease;
            -webkit-mask: linear-gradient(#000,#000) content-box, linear-gradient(#000,#000);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
        }

        .timer-border .sweep {
            position: absolute;
            inset: 0;
            border-radius: 12px;
            background: conic-gradient(from 0deg, gold 0deg, gold 0deg, transparent 0deg);
            will-change: background;
        }

        .timer-border.active {
            opacity: 1;
        }

        /* Sparkle effect */
        .sparkle {
            position: absolute;
            inset: 0;
            z-index: 2;
            pointer-events: none;
            mix-blend-mode: screen;
            opacity: 0;
            border-radius: 12px;
            background: radial-gradient(circle at center, gold 0%, transparent 70%);
        }
        
        .sparkle.active {
            opacity: 1;
            animation: spark-pop 1s ease-out 0s 1;
        }
        
        @keyframes spark-pop {
            0% { filter: blur(8px); opacity: 0; }
            40% { opacity: 1; filter: blur(2px); }
            100% { opacity: 0; filter: blur(10px); transform: scale(1.02); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-emerald-50 to-teal-100 min-h-screen">
    <div id="app" class="container mx-auto px-4 py-6">
        <!-- Header -->
        <div class="text-center mb-4 bg-gradient-to-r from-emerald-600 via-teal-600 to-emerald-600 rounded-xl shadow-2xl p-4 max-w-4xl mx-auto game-show-header header-glow">
            <div class="moving-lights">
                <div class="light"></div>
                <div class="light"></div>
                <div class="light"></div>
                <div class="light"></div>
                <div class="light"></div>
                <div class="light"></div>
                <div class="light"></div>
                <div class="light"></div>
                <div class="light"></div>
                <div class="light"></div>
            </div>
            <div class="bg-white/10 backdrop-blur-sm rounded-lg p-3 border border-white/20 relative z-10">
                <h1 class="text-2xl font-bold text-white mb-1 drop-shadow-lg">
                    <i class="fas fa-mosque text-white-300 mr-2 text-2xl"></i>
                    Game Show Cerdas Cermat
                    <i class="fas fa-graduation-cap text-white ml-2 text-2xl"></i>
                </h1>
                <p id="subtitleText" class="text-white text-lg arabic-text drop-shadow-md">Peringatan Maulid Nabi Muhammad ØµÙ„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡ ÙˆØ³Ù„Ù…</p>
            </div>
        </div>



        <!-- Settings Page -->
        <div id="settingsPage" class="max-w-4xl mx-auto">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-cog text-emerald-500 mr-2"></i>Pengaturan Game
                </h2>
                
                <!-- Team Settings -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4">Pengaturan Tim</h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-2">Jumlah Tim</label>
                            <input type="number" id="teamCount" min="2" max="8" value="5" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-2">Timer Default (detik)</label>
                            <input type="number" id="defaultTimer" min="10" max="300" value="30" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
                        </div>
                    </div>
                    
                    <div id="teamNames" class="mt-6 grid md:grid-cols-2 gap-4">
                        <!-- Team name inputs will be generated here -->
                    </div>
                    
                    <button id="generateTeams" class="mt-4 bg-emerald-500 hover:bg-emerald-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                        <i class="fas fa-users mr-2"></i>Generate Input Tim
                    </button>
                </div>

                <!-- Game Mode Settings -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4">Mode Permainan</h3>
                    <div class="bg-gradient-to-r from-blue-50 to-green-50 rounded-lg p-6 border border-blue-200">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div>
                                    <input type="radio" id="manualMode" name="gameMode" value="manual" checked class="mr-3">
                                    <label for="manualMode" class="text-lg font-semibold text-blue-700">
                                        <i class="fas fa-hand-paper mr-2"></i>Mode Manual
                                    </label>
                                    <p class="text-sm text-gray-600 ml-6 mt-1">
                                        â€¢ Host pilih tim secara manual<br>
                                        â€¢ Timer manual start/stop<br>
                                        â€¢ Skor sesuai nilai soal<br>
                                        â€¢ <strong>Cocok untuk babak rebutan/buzzer</strong>
                                    </p>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <input type="radio" id="autoMode" name="gameMode" value="auto" class="mr-3">
                                    <label for="autoMode" class="text-lg font-semibold text-green-700">
                                        <i class="fas fa-robot mr-2"></i>Mode Otomatis
                                    </label>
                                    <p class="text-sm text-gray-600 ml-6 mt-1">
                                        â€¢ Giliran tim otomatis berurutan<br>
                                        â€¢ Timer otomatis start setiap soal<br>
                                        â€¢ Skor tetap: Benar +100, Salah -50<br>
                                        â€¢ <strong>Cocok untuk babak biasa/reguler</strong>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                            <div class="flex items-start">
                                <i class="fas fa-lightbulb text-yellow-500 mr-2 mt-1"></i>
                                <div>
                                    <p class="text-sm text-yellow-800 font-medium">Tips Penggunaan:</p>
                                    <p class="text-sm text-yellow-700">
                                        <strong>Babak Biasa:</strong> Gunakan Mode Otomatis untuk pertanyaan bergiliran<br>
                                        <strong>Babak Rebutan:</strong> Gunakan Mode Manual untuk kontrol penuh host
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Question Import -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4">Import Soal</h3>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                        <i class="fas fa-file-excel text-4xl text-emerald-500 mb-4"></i>
                        <p class="text-gray-600 mb-4">Upload file Excel berisi soal-soal</p>
                        <input type="file" id="excelFile" accept=".xlsx,.xls" class="hidden">
                        <button id="uploadBtn" class="bg-emerald-500 hover:bg-emerald-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            <i class="fas fa-upload mr-2"></i>Pilih File Excel
                        </button>
                        <p class="text-sm text-gray-500 mt-2">Format: Kolom A=Kategori, B=Pertanyaan, C=Jawaban, D=Skor, E=URL Gambar (opsional)</p>
                    </div>
                    <div id="questionPreview" class="mt-4 hidden">
                        <h4 class="font-medium text-gray-700 mb-2">Preview Soal:</h4>
                        <div class="bg-gray-50 rounded-lg p-4 max-h-40 overflow-y-auto">
                            <div id="questionList"></div>
                        </div>
                    </div>
                </div>

                <!-- Manual Question Input -->
                <div class="mb-8">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4">Tambah Soal Manual</h3>
                    <div class="grid gap-4">
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-600 mb-2">Kategori</label>
                                <input type="text" id="manualCategory" placeholder="Contoh: Kelahiran Nabi" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-600 mb-2">Skor</label>
                                <input type="number" id="manualScore" min="50" max="500" value="100" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-2">Pertanyaan</label>
                            <textarea id="manualQuestion" placeholder="Masukkan soal (mendukung teks Arab + Latin)" 
                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 mixed-text" 
                                      rows="3"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-2">Jawaban (Opsional)</label>
                            <textarea id="manualAnswer" placeholder="Masukkan kunci jawaban (opsional)" 
                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 mixed-text" 
                                      rows="2"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-600 mb-2">URL Gambar (Opsional)</label>
                            <input type="url" id="manualImageUrl" placeholder="https://example.com/image.jpg" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
                            <p class="text-xs text-gray-500 mt-1">Masukkan URL gambar yang ingin ditampilkan bersama soal</p>
                        </div>
                        <button id="addQuestion" class="bg-emerald-500 hover:bg-emerald-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            <i class="fas fa-plus mr-2"></i>Tambah Soal
                        </button>
                    </div>
                </div>

                
<div class="mb-8">
  <h3 class="text-lg font-semibold text-gray-700 mb-4">Pengaturan Teks</h3>
  <div>
    <label class="block text-sm font-medium text-gray-600 mb-2">Subtitle Header</label>
    <input type="text" id="subtitleInput" 
           placeholder="Contoh: Peringatan Isra' Mi'raj"
           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
    <p class="text-xs text-gray-500 mt-1">Bisa isi teks Arab + Latin</p>
  </div>
</div>
<button id="startQuiz" class="w-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white py-4 rounded-lg font-bold text-lg transition-all duration-200 transform hover:scale-105">
                    <i class="fas fa-play mr-2"></i>Mulai Quiz
                </button>
            </div>
        </div>

        <!-- Quiz Page -->
        <div id="quizPage" class="hidden">
            <!-- Scoreboard - Ultra Compact -->
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl shadow-lg p-3 mb-6 max-w-4xl mx-auto">
                <div class="flex items-center justify-between mb-2">
                    <h3 class="text-sm font-bold text-white flex items-center">
                        <i class="fas fa-trophy text-yellow-300 mr-1"></i>Scoreboard
                    </h3>
                    <button id="resetScores" class="bg-white/20 hover:bg-white/30 text-white px-3 py-1 rounded font-medium transition-colors text-xs">
                        <i class="fas fa-redo mr-1"></i>Reset
                    </button>
                </div>
                <div id="scoreboard" class="grid grid-cols-5 gap-2">
                    <!-- Team scores will be generated here -->
                </div>
            </div>

            <!-- Question Container -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-6 max-w-4xl mx-auto">
                <!-- Question Header -->
                <div class="bg-gradient-to-r from-emerald-50 to-teal-50 px-8 py-4 border-b border-emerald-100">
                    <div class="flex items-center justify-between mb-3">
                        <span id="categoryDisplay" class="bg-purple-500 text-white px-4 py-2 rounded-full text-sm font-medium">
                            Kategori: Maulid Nabi
                        </span>
                        <span class="bg-emerald-500 text-white px-4 py-2 rounded-full text-lg font-bold">
                            Soal <span id="currentQuestionNumber">1</span> dari <span id="totalQuestions">0</span>
                        </span>
                        <span id="scoreDisplay" class="bg-orange-500 text-white px-4 py-2 rounded-full text-sm font-medium">
                            Point: 100
                        </span>
                    </div>
                    
                    <!-- Mode Status Display -->
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div id="modeDisplay" class="flex items-center gap-2">
                                <span class="text-sm font-medium text-gray-700">Mode:</span>
                                <span id="currentModeDisplay" class="bg-blue-500 text-white px-3 py-1 rounded-full text-sm font-medium">
                                    <i class="fas fa-hand-paper mr-1"></i>Manual
                                </span>
                            </div>
                            <div id="autoModeStatus" class="hidden text-sm">
                                <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full">
                                    <i class="fas fa-robot mr-1"></i>Giliran: <span id="currentTeamName">-</span>
                                </span>
                            </div>
                        </div>
                        
                        <div class="flex items-center gap-2">
                            <button id="pauseAutoBtn" class="hidden bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-2 rounded-lg font-medium transition-colors text-sm">
                                <i class="fas fa-pause mr-1"></i>Pause
                            </button>
                            <button id="nextAutoBtn" class="hidden bg-emerald-500 hover:bg-emerald-600 text-white px-3 py-2 rounded-lg font-medium transition-colors text-sm">
                                <i class="fas fa-forward mr-1"></i>Skip
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Question Content -->
                <div id="questionContainer" class="timer-container p-8 bg-gradient-to-br from-gray-800 via-gray-900 to-black">
                    <div id="timerBorder" class="timer-border">
                        <div id="sweep" class="sweep"></div>
                    </div>
                    <div id="sparkle" class="sparkle"></div>
                    <div id="questionContent" class="question-content text-white font-medium drop-shadow-lg relative z-10">
                        <div id="questionText" class="text-3xl mixed-text leading-relaxed question-text-only">
                            Pilih tim untuk memulai soal pertama
                        </div>
                        <div id="questionImageContainer" class="hidden">
                            <img id="questionImage" class="question-image" alt="Gambar soal" onerror="this.style.display='none'; document.getElementById('imageError').style.display='block';">
                            <div id="imageError" class="hidden text-red-300 text-sm bg-red-900/30 px-4 py-2 rounded-lg">
                                <i class="fas fa-exclamation-triangle mr-2"></i>Gambar gagal dimuat
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Navigation -->
                <div class="bg-gray-50 px-8 py-4">
                    <div class="flex justify-between items-center mb-4">
                        <button id="prevQuestion" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            <i class="fas fa-chevron-left mr-2"></i>Sebelumnya
                        </button>
                        <button id="showAnswerBtn" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-3 rounded-lg font-medium transition-colors text-lg">
                            <i class="fas fa-key"></i>
                        </button>
                        <button id="nextQuestion" class="bg-emerald-500 hover:bg-emerald-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            <i class="fas fa-chevron-right mr-2"></i>Selanjutnya
                        </button>
                    </div>
                    <div id="answerDisplay" class="hidden bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg">
                        <h4 class="font-bold text-blue-800 mb-2">
                            <i class="fas fa-key mr-2"></i>Kunci Jawaban:
                        </h4>
                        <div id="answerText" class="mixed-text text-blue-900 text-lg"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let teams = [];
        let gameMode = 'manual'; // 'manual' or 'auto'
        let currentTeamTurn = 0;
        let autoTimer = null;
        let isAutoPaused = false;
        let questions = [
            {
                id: 1,
                category: "Kelahiran Nabi",
                text: "Ù…ØªÙ‰ ÙˆÙÙ„Ø¯ Ø§Ù„Ù†Ø¨ÙŠ Ù…Ø­Ù…Ø¯ ØµÙ„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡ ÙˆØ³Ù„Ù…ØŸ Kapan Nabi Muhammad SAW dilahirkan?",
                answer: "12 Rabiul Awwal tahun Gajah (571 M) - Ø¹Ø§Ù… Ø§Ù„ÙÙŠÙ„",
                score: 100,
                imageUrl: ""
            },
            {
                id: 2,
                category: "Keluarga Nabi",
                text: "Ù…Ø§ Ø§Ø³Ù… Ø£Ù… Ø§Ù„Ù†Ø¨ÙŠ Ù…Ø­Ù…Ø¯ ØµÙ„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡ ÙˆØ³Ù„Ù…ØŸ Siapa nama ibu Nabi Muhammad SAW?",
                answer: "Aminah binti Wahab - Ø¢Ù…Ù†Ø© Ø¨Ù†Øª ÙˆÙ‡Ø¨",
                score: 150,
                imageUrl: ""
            },
            {
                id: 3,
                category: "Kelahiran Nabi",
                text: "ÙÙŠ Ø£ÙŠ Ù…Ø¯ÙŠÙ†Ø© ÙˆÙÙ„Ø¯ Ø§Ù„Ù†Ø¨ÙŠ ØµÙ„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡ ÙˆØ³Ù„Ù…ØŸ Di kota mana Nabi SAW dilahirkan?",
                answer: "Makkah Al-Mukarramah - Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©",
                score: 100,
                imageUrl: ""
            },
            {
                id: 4,
                category: "Keluarga Nabi",
                text: "Ù…Ø§ Ø§Ø³Ù… Ø¬Ø¯ Ø§Ù„Ù†Ø¨ÙŠ Ù…Ø­Ù…Ø¯ ØµÙ„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡ ÙˆØ³Ù„Ù…ØŸ Siapa nama kakek Nabi Muhammad SAW?",
                answer: "Abdul Muthalib - Ø¹Ø¨Ø¯ Ø§Ù„Ù…Ø·Ù„Ø¨",
                score: 200,
                imageUrl: ""
            },
            {
                id: 5,
                category: "Keluarga Nabi",
                text: "ÙƒÙ… ÙƒØ§Ù† Ø¹Ù…Ø± Ø§Ù„Ù†Ø¨ÙŠ ØµÙ„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡ ÙˆØ³Ù„Ù… Ø¹Ù†Ø¯Ù…Ø§ ØªÙˆÙÙŠ ÙˆØ§Ù„Ø¯Ù‡ØŸ Berapa usia Nabi SAW ketika ayahnya meninggal?",
                answer: "Belum lahir (masih dalam kandungan) - Ù„Ù… ÙŠÙˆÙ„Ø¯ Ø¨Ø¹Ø¯",
                score: 250,
                imageUrl: ""
            },
            {
                id: 6,
                category: "Masa Kecil",
                text: "Ù…Ø§ Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø¶Ø¹Ø© Ø§Ù„ØªÙŠ Ø£Ø±Ø¶Ø¹Øª Ø§Ù„Ù†Ø¨ÙŠ ØµÙ„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡ ÙˆØ³Ù„Ù…ØŸ Siapa nama ibu susuan Nabi SAW?",
                answer: "Halimah As-Sa'diyah - Ø­Ù„ÙŠÙ…Ø© Ø§Ù„Ø³Ø¹Ø¯ÙŠØ©",
                score: 200,
                imageUrl: ""
            },
            {
                id: 7,
                category: "Kenabian",
                text: "ÙÙŠ Ø£ÙŠ Ø¹Ø§Ù… Ø­Ø¯Ø«Øª Ø¨Ø¹Ø«Ø© Ø§Ù„Ù†Ø¨ÙŠ ØµÙ„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡ ÙˆØ³Ù„Ù…ØŸ Pada tahun berapa Nabi SAW diutus menjadi Rasul?",
                answer: "610 M (usia 40 tahun) - Ø¹Ø§Ù… Ù¦Ù¡Ù  Ù…",
                score: 300,
                imageUrl: ""
            },
            {
                id: 8,
                category: "Kenabian",
                text: "Ù…Ø§ Ø§Ø³Ù… Ø§Ù„ØºØ§Ø± Ø§Ù„Ø°ÙŠ ÙƒØ§Ù† ÙŠØªØ¹Ø¨Ø¯ ÙÙŠÙ‡ Ø§Ù„Ù†Ø¨ÙŠ ØµÙ„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡ ÙˆØ³Ù„Ù…ØŸ Apa nama gua tempat Nabi SAW beribadah?",
                answer: "Gua Hira - ØºØ§Ø± Ø­Ø±Ø§Ø¡",
                score: 250,
                imageUrl: ""
            },
            {
                id: 9,
                category: "Sahabat Nabi",
                text: "Ù…Ù† Ù‡Ùˆ Ø£ÙˆÙ„ Ù…Ù† Ø¢Ù…Ù† Ø¨Ø§Ù„Ù†Ø¨ÙŠ ØµÙ„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡ ÙˆØ³Ù„Ù… Ù…Ù† Ø§Ù„Ø±Ø¬Ø§Ù„ØŸ Siapa laki-laki pertama yang beriman kepada Nabi SAW?",
                answer: "Abu Bakar Ash-Shiddiq - Ø£Ø¨Ùˆ Ø¨ÙƒØ± Ø§Ù„ØµØ¯ÙŠÙ‚",
                score: 200,
                imageUrl: ""
            },
            {
                id: 10,
                category: "Visual Quiz",
                text: "Ù…ÙŽØ§ Ù‡ÙŽØ°ÙŽØ§ØŸ Apa ini?",
                answer: "Kitab/Buku - ÙƒÙØªÙŽØ§Ø¨",
                score: 150,
                imageUrl: "https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=400&h=300&fit=crop"
            },
            {
                id: 11,
                category: "Bahasa Arab",
                text: "Ù…ÙŽØ§ Ø§Ø³Ù’Ù…Ù Ù‡ÙŽØ°ÙŽØ§ Ø§Ù„Ù’Ù…ÙŽØ³Ù’Ø¬ÙØ¯ÙØŸ",
                answer: "Ø§Ù„Ù…Ø³Ø¬Ø¯ Ø§Ù„Ø­Ø±Ø§Ù… - Masjidil Haram",
                score: 200,
                imageUrl: ""
            }
        ];
        let currentQuestionIndex = 0;
    // ðŸ”¹ Fungsi untuk mengacak urutan soal
    function shuffleQuestions() {
        for (let i = questions.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [questions[i], questions[j]] = [questions[j], questions[i]];
        }
    }
    
        let activeTeam = null;
        let timer = null;
        let timeLeft = 30;
        let defaultTime = 30;

        // DOM elements
        const settingsPage = document.getElementById('settingsPage');
        const quizPage = document.getElementById('quizPage');
        const teamCountInput = document.getElementById('teamCount');
        const defaultTimerInput = document.getElementById('defaultTimer');
        const teamNamesDiv = document.getElementById('teamNames');
        const generateTeamsBtn = document.getElementById('generateTeams');
        const excelFile = document.getElementById('excelFile');
        const uploadBtn = document.getElementById('uploadBtn');
        const questionPreview = document.getElementById('questionPreview');
        const questionList = document.getElementById('questionList');
        const manualCategory = document.getElementById('manualCategory');
        const manualQuestion = document.getElementById('manualQuestion');
        const manualAnswer = document.getElementById('manualAnswer');
        const manualScore = document.getElementById('manualScore');
        const manualImageUrl = document.getElementById('manualImageUrl');
        const addQuestionBtn = document.getElementById('addQuestion');
        const startQuizBtn = document.getElementById('startQuiz');
        const questionContainer = document.getElementById('questionContainer');
        const questionContent = document.getElementById('questionContent');
        const questionText = document.getElementById('questionText');
        const questionImageContainer = document.getElementById('questionImageContainer');
        const questionImage = document.getElementById('questionImage');
        const currentQuestionNumber = document.getElementById('currentQuestionNumber');
        const totalQuestions = document.getElementById('totalQuestions');
        const categoryDisplay = document.getElementById('categoryDisplay');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const scoreboard = document.getElementById('scoreboard');
        const prevQuestionBtn = document.getElementById('prevQuestion');
        const nextQuestionBtn = document.getElementById('nextQuestion');
        const resetScoresBtn = document.getElementById('resetScores');
        const showAnswerBtn = document.getElementById('showAnswerBtn');
        const answerDisplay = document.getElementById('answerDisplay');
        const answerText = document.getElementById('answerText');
        const timerBorder = document.getElementById('timerBorder');
        const sweepEl = document.getElementById('sweep');
        const sparkle = document.getElementById('sparkle');
        const currentModeDisplay = document.getElementById('currentModeDisplay');
        const autoModeStatus = document.getElementById('autoModeStatus');
        const currentTeamName = document.getElementById('currentTeamName');
        const pauseAutoBtn = document.getElementById('pauseAutoBtn');
        const nextAutoBtn = document.getElementById('nextAutoBtn');
        const manualModeRadio = document.getElementById('manualMode');
        const autoModeRadio = document.getElementById('autoMode');

        // Initialize
        generateTeamInputs();
        updateQuestionPreview();
        loadGameState();

        // Event listeners
        teamCountInput.addEventListener('change', generateTeamInputs);
        defaultTimerInput.addEventListener('change', updateDefaultTimer);
        generateTeamsBtn.addEventListener('click', generateTeamInputs);
        uploadBtn.addEventListener('click', () => excelFile.click());
        excelFile.addEventListener('change', handleExcelUpload);
        addQuestionBtn.addEventListener('click', addManualQuestion);
        startQuizBtn.addEventListener('click', startQuiz);
        prevQuestionBtn.addEventListener('click', () => changeQuestion(-1));
        nextQuestionBtn.addEventListener('click', () => changeQuestion(1));
        resetScoresBtn.addEventListener('click', resetAllScores);
        showAnswerBtn.addEventListener('click', showAnswer);
        pauseAutoBtn.addEventListener('click', toggleAutoPause);
        nextAutoBtn.addEventListener('click', skipToNextQuestion);

        function switchToQuiz() {
            settingsPage.classList.add('hidden');
            quizPage.classList.remove('hidden');
        }



        function startAutoMode() {
            if (teams.length === 0) return;
            
            // Select current team
            const currentTeam = teams[currentTeamTurn];
            currentTeamName.textContent = currentTeam.name;
            activeTeam = currentTeam.id;
            
            // Update team button styles
            document.querySelectorAll('.team-button').forEach((btn, index) => {
                btn.classList.remove('bg-emerald-200');
                if (index === currentTeamTurn) {
                    btn.classList.add('bg-emerald-200');
                }
            });
            
            // Start timer automatically
            if (!isAutoPaused) {
                clearInterval(timer);
                timeLeft = defaultTime;
                startTimer();
            }
        }

        function stopAutoMode() {
            clearInterval(autoTimer);
            clearInterval(timer);
            resetTimerBorder();
            isAutoPaused = false;
            activeTeam = null;
            
            // Reset team button styles
            document.querySelectorAll('.team-button').forEach(btn => {
                btn.classList.remove('bg-emerald-200');
            });
        }

        function toggleAutoPause() {
            isAutoPaused = !isAutoPaused;
            
            if (isAutoPaused) {
                clearInterval(timer);
                resetTimerBorder();
                pauseAutoBtn.innerHTML = '<i class="fas fa-play mr-1"></i>Resume';
                pauseAutoBtn.classList.remove('bg-yellow-500', 'hover:bg-yellow-600');
                pauseAutoBtn.classList.add('bg-green-500', 'hover:bg-green-600');
            } else {
                timeLeft = defaultTime;
                startTimer();
                pauseAutoBtn.innerHTML = '<i class="fas fa-pause mr-1"></i>Pause';
                pauseAutoBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
                pauseAutoBtn.classList.add('bg-yellow-500', 'hover:bg-yellow-600');
            }
        }

        function skipToNextQuestion() {
            if (gameMode === 'auto') {
                // Move to next team
                currentTeamTurn = (currentTeamTurn + 1) % teams.length;
                
                // If we've completed a full round, move to next question
                if (currentTeamTurn === 0) {
                    changeQuestion(1);
                } else {
                    startAutoMode();
                }
            }
        }

        function generateTeamInputs() {
            const count = parseInt(teamCountInput.value);
            const defaultTeams = ['Tim Merah', 'Tim Biru', 'Tim Hijau', 'Tim Kuning', 'Tim Ungu', 'Tim Orange', 'Tim Pink', 'Tim Coklat'];
            teamNamesDiv.innerHTML = '';
            
            for (let i = 1; i <= count; i++) {
                const div = document.createElement('div');
                div.innerHTML = `
                    <label class="block text-sm font-medium text-gray-600 mb-2">Nama Tim ${i}</label>
                    <input type="text" id="team${i}" value="${defaultTeams[i-1] || `Tim ${i}`}" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
                `;
                teamNamesDiv.appendChild(div);
            }
        }

        function updateDefaultTimer() {
            defaultTime = parseInt(defaultTimerInput.value);
            timeLeft = defaultTime;
        }

        function handleExcelUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                    
                    questions = [];
                    jsonData.forEach((row, index) => {
                        if (row[1] && row[1].toString().trim()) { // Column B for question
                            questions.push({
                                id: Date.now() + index,
                                category: row[0] ? row[0].toString().trim() : 'Maulid Nabi',
                                text: row[1].toString().trim(),
                                answer: row[2] ? row[2].toString().trim() : '',
                                score: row[3] ? parseInt(row[3]) || 100 : 100,
                                imageUrl: row[4] ? row[4].toString().trim() : ''
                            });
                        }
                    });

                    updateQuestionPreview();
                    
                    Swal.fire({
                        icon: 'success',
                        title: 'Berhasil!',
                        text: `${questions.length} soal berhasil diimport`,
                        confirmButtonColor: '#10b981'
                    });
                } catch (error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error!',
                        text: 'Gagal membaca file Excel',
                        confirmButtonColor: '#ef4444'
                    });
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function addManualQuestion() {
            const questionContent = manualQuestion.value.trim();
            const categoryContent = manualCategory.value.trim() || 'Maulid Nabi';
            const answerContent = manualAnswer.value.trim();
            const scoreValue = parseInt(manualScore.value) || 100;
            const imageUrlContent = manualImageUrl.value.trim();
            
            if (!questionContent) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Peringatan!',
                    text: 'Silakan masukkan soal terlebih dahulu',
                    confirmButtonColor: '#f59e0b'
                });
                return;
            }

            questions.push({
                id: Date.now(),
                category: categoryContent,
                text: questionContent,
                answer: answerContent,
                score: scoreValue,
                imageUrl: imageUrlContent
            });

            // Clear form
            manualCategory.value = '';
            manualQuestion.value = '';
            manualAnswer.value = '';
            manualScore.value = '100';
            manualImageUrl.value = '';
            
            updateQuestionPreview();
            
            Swal.fire({
                icon: 'success',
                title: 'Berhasil!',
                text: 'Soal berhasil ditambahkan',
                confirmButtonColor: '#10b981'
            });
        }

        function updateQuestionPreview() {
            if (questions.length > 0) {
                questionPreview.classList.remove('hidden');
                questionList.innerHTML = questions.map((q, index) => 
                    `<div class="mb-2 p-2 bg-white rounded border-l-4 border-emerald-500">
                        <div class="flex items-center justify-between mb-1">
                            <span class="font-medium text-emerald-600">${index + 1}.</span>
                            <div class="flex gap-2">
                                <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs">${q.category}</span>
                                <span class="bg-orange-100 text-orange-800 px-2 py-1 rounded text-xs">${q.score} poin</span>
                                ${q.imageUrl ? '<span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs"><i class="fas fa-image mr-1"></i>Gambar</span>' : ''}
                            </div>
                        </div>
                        <span class="mixed-text">${q.text}</span>
                    </div>`
                ).join('');
            } else {
                questionPreview.classList.add('hidden');
            }
        }

        function startQuiz() {
        const subtitleInput = document.getElementById('subtitleInput');
        const subtitleText = document.getElementById('subtitleText');
        if (subtitleInput && subtitleText) {
            if (subtitleInput.value.trim()) {
                subtitleText.textContent = subtitleInput.value.trim();
            } else {
                subtitleText.textContent = "Peringatan Maulid Nabi Muhammad ØµÙ„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡ ÙˆØ³Ù„Ù…";
            }
        }

            // Collect team names
            teams = [];
            const teamCount = parseInt(teamCountInput.value);
            
            for (let i = 1; i <= teamCount; i++) {
                const teamName = document.getElementById(`team${i}`).value.trim() || `Tim ${i}`;
                teams.push({
                    id: i,
                    name: teamName,
                    score: 0
                });
            }

            if (questions.length === 0) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Peringatan!',
                    text: 'Silakan tambahkan soal terlebih dahulu',
                    confirmButtonColor: '#f59e0b'
                });
                return;
            }

            // Set game mode from settings
            // ðŸ”¹ Acak soal sebelum mulai
            shuffleQuestions();
            gameMode = autoModeRadio.checked ? 'auto' : 'manual';
            
            // Update mode display
            if (gameMode === 'auto') {
                currentModeDisplay.innerHTML = '<i class="fas fa-robot mr-1"></i>Otomatis';
                currentModeDisplay.classList.remove('bg-blue-500');
                currentModeDisplay.classList.add('bg-green-500');
                autoModeStatus.classList.remove('hidden');
                pauseAutoBtn.classList.remove('hidden');
                nextAutoBtn.classList.remove('hidden');
            } else {
                currentModeDisplay.innerHTML = '<i class="fas fa-hand-paper mr-1"></i>Manual';
                currentModeDisplay.classList.remove('bg-green-500');
                currentModeDisplay.classList.add('bg-blue-500');
                autoModeStatus.classList.add('hidden');
                pauseAutoBtn.classList.add('hidden');
                nextAutoBtn.classList.add('hidden');
            }

            // Switch to quiz page
            switchToQuiz();
            
            // Initialize quiz
            currentQuestionIndex = 0;
            currentTeamTurn = 0;
            updateQuestionDisplay();
            generateScoreboard();
            saveGameState();
            
            // Start auto mode if selected
            if (gameMode === 'auto') {
                startAutoMode();
            }
            
            const modeText = gameMode === 'auto' ? 'Mode Otomatis - Giliran tim otomatis' : 'Mode Manual - Klik nama tim untuk memulai';
            
            Swal.fire({
                icon: 'success',
                title: 'Quiz Dimulai!',
                text: modeText,
                confirmButtonColor: '#10b981'
            });
        }

        function generateScoreboard() {
            const teamColors = [
                { bg: 'bg-red-500', hover: 'hover:bg-red-600', text: 'text-white' },
                { bg: 'bg-blue-500', hover: 'hover:bg-blue-600', text: 'text-white' },
                { bg: 'bg-green-500', hover: 'hover:bg-green-600', text: 'text-white' },
                { bg: 'bg-yellow-500', hover: 'hover:bg-yellow-600', text: 'text-black' },
                { bg: 'bg-purple-500', hover: 'hover:bg-purple-600', text: 'text-white' },
                { bg: 'bg-orange-500', hover: 'hover:bg-orange-600', text: 'text-white' },
                { bg: 'bg-pink-500', hover: 'hover:bg-pink-600', text: 'text-white' },
                { bg: 'bg-amber-600', hover: 'hover:bg-amber-700', text: 'text-white' }
            ];
            
            scoreboard.innerHTML = teams.map((team, index) => {
                const color = teamColors[index] || teamColors[0];
                
                // Auto mode uses fixed scoring: +100 correct, -50 wrong
                // Manual mode uses question-based scoring
                let correctPoints, wrongPoints;
                if (gameMode === 'auto') {
                    correctPoints = 100;
                    wrongPoints = 50;
                } else {
                    const currentQuestion = questions[currentQuestionIndex];
                    correctPoints = currentQuestion ? currentQuestion.score : 100;
                    wrongPoints = Math.floor(correctPoints * 0.5); // 50% penalty
                }
                
                const teamButtonDisabled = gameMode === 'auto' ? 'pointer-events-none opacity-75' : '';
                
                return `
                <div class="${color.bg} rounded-lg p-2 shadow-lg border-2 border-white/30">
                    <button onclick="selectTeam(${team.id})" 
                            class="team-button w-full text-center font-bold ${color.text} ${color.hover} transition-colors mb-1 text-xs truncate py-1 rounded ${teamButtonDisabled}">
                        ${team.name}
                    </button>
                    <div class="flex items-center justify-between mb-1">
                        <button onclick="updateScore(${team.id}, -${wrongPoints})" 
                                class="bg-red-600 hover:bg-red-700 text-white w-6 h-6 rounded-full text-xs font-bold transition-colors flex items-center justify-center shadow-md">
                            -
                        </button>
                        <span class="text-xl font-bold text-white mx-1 drop-shadow-lg">${team.score}</span>
                        <button onclick="updateScore(${team.id}, ${correctPoints})" 
                                class="bg-green-600 hover:bg-green-700 text-white w-6 h-6 rounded-full text-xs font-bold transition-colors flex items-center justify-center shadow-md">
                            +
                        </button>
                    </div>
                </div>
            `;
            }).join('');
        }

        function selectTeam(teamId) {
            // Only allow manual team selection in manual mode
            if (gameMode === 'auto') return;
            
            activeTeam = teamId;
            const team = teams.find(t => t.id === teamId);
            
            // Reset and start timer
            clearInterval(timer);
            timeLeft = defaultTime;
            startTimer();
            
            // Update team button styles
            document.querySelectorAll('.team-button').forEach(btn => {
                btn.classList.remove('bg-emerald-200');
            });
            event.target.classList.add('bg-emerald-200');
            
            Swal.fire({
                icon: 'info',
                title: `${team.name} Aktif!`,
                text: 'Timer dimulai, silakan jawab soal',
                timer: 2000,
                showConfirmButton: false
            });
        }

        let timerStart = null;
        let timerAnimationId = null;

        function startTimer() {
            timerBorder.classList.add('active');
            sparkle.classList.remove('active');
            timerStart = performance.now();
            
            function animateTimer(timestamp) {
                if (!timerStart) timerStart = timestamp;
                const elapsed = (timestamp - timerStart) / 1000;
                const progress = Math.min(elapsed / defaultTime, 1);
                const angle = progress * 360;
                
                // Create gradient from green to red based on progress
                const startColor = '#10b981'; // Green
                const endColor = '#ef4444';   // Red
                
                // Calculate intermediate color
                const r1 = parseInt(startColor.slice(1, 3), 16);
                const g1 = parseInt(startColor.slice(3, 5), 16);
                const b1 = parseInt(startColor.slice(5, 7), 16);
                
                const r2 = parseInt(endColor.slice(1, 3), 16);
                const g2 = parseInt(endColor.slice(3, 5), 16);
                const b2 = parseInt(endColor.slice(5, 7), 16);
                
                const r = Math.round(r1 + (r2 - r1) * progress);
                const g = Math.round(g1 + (g2 - g1) * progress);
                const b = Math.round(b1 + (b2 - b1) * progress);
                
                const currentColor = `rgb(${r}, ${g}, ${b})`;
                
                sweepEl.style.background = `conic-gradient(from 0deg, ${startColor} 0deg, ${currentColor} ${angle}deg, transparent ${angle}deg)`;
                
                if (progress < 1 && timeLeft > 0) {
                    timerAnimationId = requestAnimationFrame(animateTimer);
                } else {
                    sweepEl.style.background = `conic-gradient(from 0deg, ${startColor} 0deg, ${endColor} 360deg)`;
                    sparkle.classList.add('active');
                    
                    if (timeLeft <= 0) {
                        Swal.fire({
                            icon: 'warning',
                            title: 'Waktu Habis!',
                            text: 'Silakan lanjut ke soal berikutnya',
                            confirmButtonColor: '#f59e0b'
                        });
                    }
                }
            }
            
            timerAnimationId = requestAnimationFrame(animateTimer);
            
            timer = setInterval(() => {
                timeLeft--;
                if (timeLeft <= 0) {
                    clearInterval(timer);
                }
            }, 1000);
        }

        function resetTimerBorder() {
            timerBorder.classList.remove('active');
            sparkle.classList.remove('active');
            sweepEl.style.background = `conic-gradient(from 0deg, #10b981 0deg, #10b981 0deg, transparent 0deg)`;
            if (timerAnimationId) {
                cancelAnimationFrame(timerAnimationId);
                timerAnimationId = null;
            }
            timerStart = null;
        }

        function updateScore(teamId, points) {
            const team = teams.find(t => t.id === teamId);
            team.score = Math.max(0, team.score + points);
            
            // Stop timer when score is updated
            clearInterval(timer);
            resetTimerBorder();
            timeLeft = defaultTime;
            
            generateScoreboard();
            saveGameState();
            
            const action = points > 0 ? 'Benar' : 'Salah';
            const icon = points > 0 ? 'success' : 'error';
            
            Swal.fire({
                icon: icon,
                title: `${action}!`,
                text: `${team.name} ${points > 0 ? '+' : ''}${points} poin`,
                timer: 1500,
                showConfirmButton: false
            });

            // In auto mode, automatically move to next team after scoring
            if (gameMode === 'auto' && !isAutoPaused) {
                setTimeout(() => {
                    currentTeamTurn = (currentTeamTurn + 1) % teams.length;
                    
                    // If we've completed a full round, move to next question
                    if (currentTeamTurn === 0) {
                        changeQuestion(1);
                    } else {
                        startAutoMode();
                    }
                }, 2000); // Wait 2 seconds after scoring
            }
        }

        function updateQuestionDisplay() {
            if (questions.length > 0) {
                const currentQuestion = questions[currentQuestionIndex];
                
                // Detect text direction
                const textDirection = detectTextDirection(currentQuestion.text);
                questionText.innerHTML = currentQuestion.text;
                questionText.className = `text-3xl leading-relaxed font-medium drop-shadow-lg ${textDirection}`;
                
                currentQuestionNumber.textContent = currentQuestionIndex + 1;
                totalQuestions.textContent = questions.length;
                categoryDisplay.textContent = `Kategori: ${currentQuestion.category}`;
                scoreDisplay.textContent = `Point: ${currentQuestion.score}`;
                
                // Handle image display
                if (currentQuestion.imageUrl && currentQuestion.imageUrl.trim()) {
                    questionImageContainer.classList.remove('hidden');
                    questionImage.src = currentQuestion.imageUrl;
                    questionImage.style.display = 'block';
                    document.getElementById('imageError').style.display = 'none';
                    // Update class to include image layout
                    questionText.className = questionText.className.replace('question-text-only', 'question-with-image');
                } else {
                    questionImageContainer.classList.add('hidden');
                    // Keep the direction class but update layout class
                    questionText.className = questionText.className.replace('question-with-image', 'question-text-only');
                }
                
                // Update navigation buttons
                prevQuestionBtn.disabled = currentQuestionIndex === 0;
                nextQuestionBtn.disabled = currentQuestionIndex === questions.length - 1;
                
                if (prevQuestionBtn.disabled) {
                    prevQuestionBtn.classList.add('opacity-50', 'cursor-not-allowed');
                } else {
                    prevQuestionBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
                
                if (nextQuestionBtn.disabled) {
                    nextQuestionBtn.classList.add('opacity-50', 'cursor-not-allowed');
                } else {
                    nextQuestionBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
                
                // Update scoreboard with new question scores
                generateScoreboard();
            }
        }

        function changeQuestion(direction) {
            const newIndex = currentQuestionIndex + direction;
            
            if (newIndex >= 0 && newIndex < questions.length) {
                currentQuestionIndex = newIndex;
                updateQuestionDisplay();
                saveGameState();
                
                // Reset timer and hide answer
                clearInterval(timer);
                resetTimerBorder();
                timeLeft = defaultTime;
                answerDisplay.classList.add('hidden');
                
                // In auto mode, restart with first team
                if (gameMode === 'auto') {
                    currentTeamTurn = 0;
                    startAutoMode();
                }
            }
        }

        function resetAllScores() {
            Swal.fire({
                title: 'Reset Semua Skor?',
                text: 'Semua skor tim akan dikembalikan ke 0',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                cancelButtonColor: '#6b7280',
                confirmButtonText: 'Ya, Reset!',
                cancelButtonText: 'Batal'
            }).then((result) => {
                if (result.isConfirmed) {
                    teams.forEach(team => team.score = 0);
                    generateScoreboard();
                    saveGameState();
                    
                    Swal.fire({
                        icon: 'success',
                        title: 'Berhasil!',
                        text: 'Semua skor telah direset',
                        confirmButtonColor: '#10b981'
                    });
                }
            });
        }

        function showAnswer() {
            if (questions.length > 0 && questions[currentQuestionIndex]) {
                const currentQuestion = questions[currentQuestionIndex];
                const answer = currentQuestion.answer || 'Kunci jawaban tidak tersedia';
                
                answerText.innerHTML = answer;
                answerDisplay.classList.toggle('hidden');
            }
        }

        function saveGameState() {
            const gameState = {
                teams: teams,
                questions: questions,
                currentQuestionIndex: currentQuestionIndex,
                defaultTime: defaultTime
            };
            localStorage.setItem('maulidQuizGame', JSON.stringify(gameState));
        }

        function detectTextDirection(text) {
            // Remove HTML tags and extra spaces
            const cleanText = text.replace(/<[^>]*>/g, '').trim();
            
            // Arabic Unicode range: \u0600-\u06FF, \u0750-\u077F, \u08A0-\u08FF, \uFB50-\uFDFF, \uFE70-\uFEFF
            const arabicRegex = /[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/g;
            const latinRegex = /[A-Za-z]/g;
            
            const arabicMatches = cleanText.match(arabicRegex) || [];
            const latinMatches = cleanText.match(latinRegex) || [];
            
            // If there are Arabic characters but no Latin characters, use RTL
            if (arabicMatches.length > 0 && latinMatches.length === 0) {
                return 'arabic-only question-text-only';
            }
            
            // If there are both Arabic and Latin characters, or only Latin, use LTR
            return 'mixed-text question-text-only';
        }

        function loadGameState() {
            const savedState = localStorage.getItem('maulidQuizGame');
            if (savedState) {
                try {
                    const gameState = JSON.parse(savedState);
                    if (gameState.teams && gameState.teams.length > 0) {
                        teams = gameState.teams;
                    }
                    if (gameState.questions && gameState.questions.length > 0) {
                        questions = gameState.questions;
                        updateQuestionPreview();
                    }
                    if (gameState.currentQuestionIndex !== undefined) {
                        currentQuestionIndex = gameState.currentQuestionIndex;
                    }
                    if (gameState.defaultTime) {
                        defaultTime = gameState.defaultTime;
                        defaultTimerInput.value = defaultTime;
                        timeLeft = defaultTime;
                    }
                } catch (error) {
                    console.log('Error loading game state:', error);
                }
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97ce5b9152f0dfc6',t:'MTc1NzUwMTM1Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
