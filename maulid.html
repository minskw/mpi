<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🕌 Gebyar Maulid Nabi 🕌</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        .game-font { font-family: 'Fredoka One', cursive; }
        .arabic-font { font-family: 'Amiri', serif; }
        
        @keyframes bounce-in {
            0% { transform: scale(0) rotate(180deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(90deg); opacity: 0.8; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        
        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.8); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0) scale(0.95); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-8px) scale(0.95); }
            20%, 40%, 60%, 80% { transform: translateX(8px) scale(0.95); }
        }
        
        @keyframes score-fly {
            0% { 
                transform: translateY(0) scale(1); 
                opacity: 1; 
            }
            50% { 
                transform: translateY(-50px) scale(1.5); 
                opacity: 0.8; 
            }
            100% { 
                transform: translateY(-100px) scale(0.5); 
                opacity: 0; 
            }
        }
        
        .bounce-in { animation: bounce-in 0.8s ease-out; }
        .rainbow-bg { 
            background: linear-gradient(-45deg, #2d5a27, #4a7c59, #6b8e23, #8fbc8f, #228b22, #32cd32);
            background-size: 400% 400%;
            animation: rainbow 3s ease infinite;
        }
        .float-animation { animation: float 3s ease-in-out infinite; }
        .sparkle { animation: sparkle 2s ease-in-out infinite; }
        .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        .shake { animation: shake 0.8s ease-in-out; }
        .score-fly { animation: score-fly 1.5s ease-out forwards; }
        
        .question-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 15px;
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #f39c12;
            animation: confetti-fall 3s linear infinite;
        }
        
        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
    </style>
</head>
<body class="rainbow-bg min-h-screen">


    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <div class="text-center mb-8 bounce-in">
            <h1 class="game-font text-4xl md:text-5xl text-white mb-4 drop-shadow-lg">
                🕌 GEBYAR MAULID NABI 🕌
            </h1>
            <p class="text-2xl text-white font-bold drop-shadow-md">
                <i class="fas fa-star-and-crescent text-yellow-300"></i> 
                Kompetisi Islami Menyambut Kelahiran Rasulullah ﷺ 
                <i class="fas fa-star-and-crescent text-yellow-300"></i>
            </p>
        </div>

        <!-- Setup Screen -->
        <div id="setup-screen" class="max-w-4xl mx-auto space-y-6">
            <!-- Question Import Section -->
            <div class="bg-white/95 rounded-lg p-4">
                <h2 class="game-font text-2xl text-center mb-4 text-purple-800">Import Soal</h2>
                
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <h3 class="font-bold mb-2">Upload File Excel</h3>
                        <input type="file" id="question-file" accept=".xlsx,.xls" class="w-full p-2 border rounded">
                        <button onclick="importQuestions()" class="bg-blue-500 text-white px-4 py-2 rounded w-full mt-2">Import Excel</button>
                        <button onclick="downloadTemplate()" class="bg-green-500 text-white px-4 py-2 rounded w-full mt-2">Download Template</button>
                    </div>
                    
                    <div>
                        <h3 class="font-bold mb-2">Tambah Manual</h3>
                        <input type="text" id="manual-question" placeholder="Pertanyaan..." class="w-full p-2 border rounded mb-2">
                        <div class="grid grid-cols-2 gap-1">
                            <input type="text" id="manual-a" placeholder="A" class="p-1 border rounded text-sm">
                            <input type="text" id="manual-b" placeholder="B" class="p-1 border rounded text-sm">
                            <input type="text" id="manual-c" placeholder="C" class="p-1 border rounded text-sm">
                            <input type="text" id="manual-d" placeholder="D" class="p-1 border rounded text-sm">
                        </div>
                        <select id="manual-correct" class="w-full p-1 border rounded mt-1 text-sm">
                            <option value="">Jawaban benar</option>
                            <option value="a">A</option>
                            <option value="b">B</option>
                            <option value="c">C</option>
                            <option value="d">D</option>
                        </select>
                        <select id="manual-language" class="w-full p-1 border rounded mt-1 text-sm">
                            <option value="indonesia">Indonesia</option>
                            <option value="arabic">Arab</option>
                            <option value="english">English</option>
                        </select>
                        <button onclick="addManualQuestion()" class="bg-green-500 text-white px-4 py-1 rounded w-full mt-2 text-sm">Tambah</button>
                    </div>
                </div>
                
                <div class="mt-4 p-2 bg-gray-100 rounded">
                    <strong>Bank Soal: <span id="question-count">0</span> soal</strong>
                    <div class="text-xs text-gray-600 mt-1">
                        <span id="question-info">Pilih jumlah soal yang akan dimainkan di bawah</span>
                    </div>
                    <div id="question-preview" class="max-h-20 overflow-y-auto text-xs mt-1"></div>
                </div>
            </div>

            <!-- Team Setup -->
            <div class="bg-white/95 rounded-lg p-4">
                <h2 class="game-font text-2xl text-center mb-4 text-purple-800">Setup Tim</h2>
                
                <div class="grid md:grid-cols-2 gap-4 mb-4">
                    <div class="text-center">
                        <h3 class="font-bold mb-2">Jumlah Tim</h3>
                        <div class="flex justify-center gap-2">
                            <button class="team-count-btn bg-red-500 text-white font-bold py-2 px-4 rounded" data-count="2">2</button>
                            <button class="team-count-btn bg-blue-500 text-white font-bold py-2 px-4 rounded" data-count="3">3</button>
                            <button class="team-count-btn bg-green-500 text-white font-bold py-2 px-4 rounded" data-count="4">4</button>
                            <button class="team-count-btn bg-purple-500 text-white font-bold py-2 px-4 rounded" data-count="5">5</button>
                        </div>
                    </div>

                    <div class="text-center">
                        <h3 class="font-bold mb-2">Jumlah Soal</h3>
                        <div class="flex justify-center gap-2 flex-wrap">
                            <button class="question-count-btn bg-blue-500 text-white font-bold py-2 px-4 rounded" data-count="10">10</button>
                            <button class="question-count-btn bg-green-500 text-white font-bold py-2 px-4 rounded" data-count="15">15</button>
                            <button class="question-count-btn bg-purple-500 text-white font-bold py-2 px-4 rounded" data-count="20">20</button>
                            <button class="question-count-btn bg-orange-500 text-white font-bold py-2 px-4 rounded" data-count="25">25</button>
                            <button class="question-count-btn bg-red-500 text-white font-bold py-2 px-4 rounded" data-count="30">30</button>
                        </div>
                        <div class="text-sm text-gray-600 mt-2">
                            Pilih berapa soal yang akan dimainkan
                        </div>
                    </div>
                </div>

                <div id="team-names" class="mb-4">
                    <!-- Team name inputs will be generated here -->
                </div>

                <div class="text-center">
                    <button id="start-game-btn" class="bg-gradient-to-r from-purple-500 to-blue-500 text-white font-bold text-xl px-8 py-3 rounded-lg disabled:opacity-50" disabled>
                        MULAI GAME SHOW!
                    </button>
                </div>
            </div>

            <!-- Game Rules -->
            <div class="bg-white/95 rounded-lg p-4">
                <h3 class="font-bold text-center mb-3">Cara Bermain</h3>
                <div class="grid md:grid-cols-2 gap-4 text-sm">
                    <div>
                        <p>• Tim bergantian menjawab</p>
                        <p>• Waktu: 30 detik per soal</p>
                        <p>• Benar: +100 poin</p>
                    </div>
                    <div>
                        <p>• Salah: -50 poin</p>
                        <p>• Poin tertinggi menang</p>
                        <p>• Selamat bermain!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="hidden">
            <!-- Header Sederhana -->
            <div class="bg-gradient-to-r from-purple-600 to-blue-600 text-white p-4 shadow-lg">
                <div class="max-w-6xl mx-auto">
                    <div class="flex justify-between items-center mb-2">
                        <div class="bg-yellow-400 text-purple-800 px-6 py-3 rounded-full font-bold text-xl">
                            <i class="fas fa-star mr-2"></i><span id="current-team">Tim 1</span>
                        </div>
                        
                        <div class="bg-white/20 px-6 py-3 rounded-lg font-bold text-xl">
                            Soal <span id="current-question-number">1</span> dari <span id="total-questions-display">10</span>
                        </div>
                        
                        <div id="timer-display" class="bg-green-500 px-6 py-3 rounded-full font-bold text-2xl">
                            <i class="fas fa-clock mr-2"></i><span id="question-timer">30</span>s
                        </div>
                    </div>
                    
                    <!-- Progress Bar -->
                    <div class="bg-white/20 rounded-full h-2 mb-2">
                        <div id="progress-bar" class="bg-yellow-400 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                    <div class="text-center text-white text-sm font-bold">
                        <span id="progress-text">0% Selesai</span>
                    </div>
                </div>
            </div>

            <!-- Area Konten Game Fullscreen -->
            <div class="h-screen bg-gradient-to-br from-pink-400 via-purple-500 to-indigo-600 p-4 flex flex-col">
                <div class="max-w-7xl mx-auto w-full flex-1 flex flex-col">
                    <!-- Pertanyaan - BESAR DAN JELAS -->
                    <div class="bg-white rounded-xl p-8 mb-6 text-center flex-shrink-0 shadow-lg">
                        <h2 id="question-text" class="text-3xl font-bold text-gray-800 leading-relaxed min-h-[100px] flex items-center justify-center">
                            Apa ibu kota Indonesia?
                        </h2>
                    </div>
                    
                    <!-- Opsi Jawaban - BESAR DAN JELAS -->
                    <div id="question-options" class="grid grid-cols-2 gap-6 mb-6 flex-shrink-0">
                        <!-- Contoh jawaban untuk preview -->
                        <button class="bg-red-500 hover:bg-red-600 text-white font-bold text-xl p-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-xl min-h-[80px] flex items-center justify-start">
                            <div class="flex items-center gap-4">
                                <div class="bg-white text-red-500 font-black text-xl w-10 h-10 rounded-lg flex items-center justify-center shadow-md">A</div>
                                <span>Jakarta</span>
                            </div>
                        </button>
                        <button class="bg-blue-500 hover:bg-blue-600 text-white font-bold text-xl p-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-xl min-h-[80px] flex items-center justify-start">
                            <div class="flex items-center gap-4">
                                <div class="bg-white text-blue-500 font-black text-xl w-10 h-10 rounded-lg flex items-center justify-center shadow-md">B</div>
                                <span>Surabaya</span>
                            </div>
                        </button>
                        <button class="bg-purple-500 hover:bg-purple-600 text-white font-bold text-xl p-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-xl min-h-[80px] flex items-center justify-start">
                            <div class="flex items-center gap-4">
                                <div class="bg-white text-purple-500 font-black text-xl w-10 h-10 rounded-lg flex items-center justify-center shadow-md">C</div>
                                <span>Bandung</span>
                            </div>
                        </button>
                        <button class="bg-green-500 hover:bg-green-600 text-white font-bold text-xl p-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-xl min-h-[80px] flex items-center justify-start">
                            <div class="flex items-center gap-4">
                                <div class="bg-white text-green-500 font-black text-xl w-10 h-10 rounded-lg flex items-center justify-center shadow-md">D</div>
                                <span>Medan</span>
                            </div>
                        </button>
                    </div>
                    
                    <!-- Skor Tim Horizontal - Compact -->
                    <div id="scoreboard-container" class="bg-white/95 backdrop-blur-sm rounded-xl p-3 flex-shrink-0">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="game-font text-lg text-purple-800">
                                <i class="fas fa-trophy text-yellow-500"></i> SKOR TIM
                            </h3>
                            <div class="flex gap-2">
                                <button id="pause-game-btn" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-1 px-3 rounded-lg transition-all text-xs">
                                    <i class="fas fa-pause mr-1"></i>Jeda
                                </button>
                                <button id="skip-question-btn" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-1 px-3 rounded-lg transition-all text-xs">
                                    <i class="fas fa-forward mr-1"></i>Lewati
                                </button>
                                <button id="end-game-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-1 px-3 rounded-lg transition-all text-xs">
                                    <i class="fas fa-stop mr-1"></i>Akhiri
                                </button>
                            </div>
                        </div>
                        <div id="team-scores" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2">
                            <!-- Skor tim akan dibuat di sini -->
                        </div>
                    </div>
                    
                    <!-- Tombol Next (Hidden by default) -->
                    <div class="text-center mt-3 flex-shrink-0">
                        <button id="next-question-btn" class="game-button text-lg px-6 py-2 hidden">
                            <i class="fas fa-arrow-right mr-2"></i>Soal Berikutnya
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="hidden text-center">
            <div class="bg-white/90 backdrop-blur-sm rounded-3xl p-8 max-w-4xl mx-auto">
                <h2 class="game-font text-6xl mb-8 text-purple-800">
                    <i class="fas fa-crown text-yellow-500"></i> HASIL AKHIR <i class="fas fa-crown text-yellow-500"></i>
                </h2>
                
                <div id="final-rankings" class="space-y-6 mb-8">
                    <!-- Final rankings will be generated here -->
                </div>

                <div class="flex justify-center gap-4">
                    <button id="restart-btn" class="game-button text-2xl px-8 py-4">
                        <i class="fas fa-redo"></i> Main Lagi
                    </button>
                    <button id="export-results-btn" class="game-button text-2xl px-8 py-4">
                        <i class="fas fa-download"></i> Export Hasil
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class GameShow {
            constructor() {
                this.questions = [
                    // Default questions
                    { question: "Apa ibu kota Indonesia?", options: ["Jakarta", "Surabaya", "Bandung", "Medan"], correct: 0, language: "indonesia" },
                    { question: "Berapa hasil dari 7 × 8?", options: ["54", "56", "58", "52"], correct: 1, language: "indonesia" },
                    { question: "كم عدد الصلوات في اليوم؟", options: ["ثلاث", "أربع", "خمس", "ست"], correct: 2, language: "arabic" },
                    { question: "What color do you get when you mix red and blue?", options: ["Green", "Purple", "Orange", "Yellow"], correct: 1, language: "english" },
                    { question: "Siapa penemu telepon?", options: ["Edison", "Alexander Bell", "Tesla", "Einstein"], correct: 1, language: "indonesia" },
                    { question: "ما هو أكبر كوكب في النظام الشمسي؟", options: ["الأرض", "المشتري", "زحل", "المريخ"], correct: 1, language: "arabic" },
                    { question: "How many days are there in a week?", options: ["6", "7", "8", "5"], correct: 1, language: "english" },
                    { question: "Berapa jumlah benua di dunia?", options: ["5", "6", "7", "8"], correct: 2, language: "indonesia" },
                    { question: "ما هي عاصمة مصر؟", options: ["الإسكندرية", "القاهرة", "الجيزة", "أسوان"], correct: 1, language: "arabic" },
                    { question: "What is 10 + 15?", options: ["20", "25", "30", "35"], correct: 1, language: "english" }
                ];
                
                // Sound effects
                this.sounds = {
                    correct: new Audio('https://archive.org/download/jeopardy_202509/rightanswer.mp3'),
                    wrong: new Audio('https://archive.org/download/jeopardy_202509/jeopardy-incorrect-answer.mp3'),
                    timeout: new Audio('https://archive.org/download/jeopardy_202509/times-up_AN8OlqZ.mp3')
                };
                
                // Configure sound settings
                Object.values(this.sounds).forEach(sound => {
                    sound.volume = 0.7;
                    sound.preload = 'auto';
                });
                
                this.teams = [];
                this.currentTeamIndex = 0;
                this.currentQuestionIndex = 0;
                this.totalQuestions = 0; // Will be set when user selects
                this.gameQuestions = []; // Questions selected for current game
                this.gameActive = false;
                this.questionTimer = null;
                this.timeLeft = 30;
                this.gamePaused = false;
                this.teamAnswers = {}; // Store team answers for CERDAS CERMAT
                this.answeredTeams = new Set(); // Track which teams have answered
                this.stats = {
                    correct: 0,
                    wrong: 0,
                    timeout: 0
                };
                this.teamColors = [
                    'bg-gradient-to-r from-red-400 to-red-600',
                    'bg-gradient-to-r from-blue-400 to-blue-600',
                    'bg-gradient-to-r from-green-400 to-green-600',
                    'bg-gradient-to-r from-yellow-400 to-yellow-600',
                    'bg-gradient-to-r from-purple-400 to-purple-600'
                ];
                
                this.initializeElements();
                this.bindEvents();
                this.updateQuestionCount();
            }
            
            initializeElements() {
                this.setupScreen = document.getElementById('setup-screen');
                this.gameScreen = document.getElementById('game-screen');
                this.resultsScreen = document.getElementById('results-screen');
                this.teamNamesContainer = document.getElementById('team-names');
                this.startGameBtn = document.getElementById('start-game-btn');
                this.restartBtn = document.getElementById('restart-btn');
                this.teamScoresContainer = document.getElementById('team-scores');
                this.scoreboardContainer = document.getElementById('scoreboard-container');
                this.currentTeamElement = document.getElementById('current-team');
                this.timerDisplay = document.getElementById('timer-display');
                this.questionTimerElement = document.getElementById('question-timer');
                this.questionDisplay = document.getElementById('question-display');
                this.questionText = document.getElementById('question-text');
                this.questionOptions = document.getElementById('question-options');
                this.currentQuestionNumber = document.getElementById('current-question-number');
                this.nextQuestionBtn = document.getElementById('next-question-btn');
                this.finalRankingsElement = document.getElementById('final-rankings');
                this.questionCountElement = document.getElementById('question-count');
                this.questionPreview = document.getElementById('question-preview');
            }
            
            bindEvents() {
                // Team count selection
                document.querySelectorAll('.team-count-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.team-count-btn').forEach(b => b.classList.remove('ring-4', 'ring-white'));
                        e.target.classList.add('ring-4', 'ring-white');
                        this.setupTeamNames(parseInt(e.target.dataset.count));
                    });
                });
                
                // Question count selection
                document.querySelectorAll('.question-count-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.question-count-btn').forEach(b => b.classList.remove('ring-4', 'ring-white'));
                        e.target.classList.add('ring-4', 'ring-white');
                        this.totalQuestions = parseInt(e.target.dataset.count);
                        this.checkStartButton();
                    });
                });
                
                this.startGameBtn.addEventListener('click', () => this.startGame());
                this.restartBtn.addEventListener('click', () => this.restartGame());
                this.nextQuestionBtn.addEventListener('click', () => this.nextQuestion());
                document.getElementById('export-results-btn').addEventListener('click', () => this.exportResults());
                
                // Game control buttons
                document.getElementById('pause-game-btn').addEventListener('click', () => this.pauseGame());
                document.getElementById('skip-question-btn').addEventListener('click', () => this.skipQuestion());
                document.getElementById('end-game-btn').addEventListener('click', () => this.confirmEndGame());
            }
            
            setupTeamNames(count) {
                this.teamNamesContainer.innerHTML = '';
                
                const div = document.createElement('div');
                div.className = 'grid grid-cols-2 gap-3';
                
                for (let i = 0; i < count; i++) {
                    const teamDiv = document.createElement('div');
                    teamDiv.className = 'bg-blue-100 p-3 rounded text-center';
                    teamDiv.innerHTML = `
                        <label class="block font-bold mb-2">Tim ${i + 1}:</label>
                        <input type="text" class="team-name-input w-full p-2 border rounded text-center" placeholder="Nama Tim ${i + 1}" maxlength="20">
                    `;
                    div.appendChild(teamDiv);
                }
                
                this.teamNamesContainer.appendChild(div);
                
                // Enable start button when setup is complete
                const inputs = document.querySelectorAll('.team-name-input');
                inputs.forEach(input => {
                    input.addEventListener('input', () => {
                        this.checkStartButton();
                    });
                });
                
                setTimeout(() => {
                    this.checkStartButton();
                }, 100);
            }
            
            checkStartButton() {
                const inputs = document.querySelectorAll('.team-name-input');
                const hasQuestions = this.questions.length > 0;
                const hasTeams = inputs.length > 0;
                const hasQuestionCount = this.totalQuestions > 0;
                
                // Update info about available questions
                const infoElement = document.getElementById('question-info');
                if (this.questions.length > 0 && this.totalQuestions > 0) {
                    const gameQuestions = Math.min(this.totalQuestions, this.questions.length);
                    infoElement.textContent = `Tersedia ${this.questions.length} soal. Game akan menggunakan ${gameQuestions} soal acak.`;
                } else if (this.questions.length > 0) {
                    infoElement.textContent = `Tersedia ${this.questions.length} soal. Pilih jumlah soal yang akan dimainkan.`;
                } else {
                    infoElement.textContent = 'Import atau tambah soal terlebih dahulu';
                }
                
                this.startGameBtn.disabled = !(hasQuestions && hasTeams && hasQuestionCount);
            }
            
            importQuestions() {
                const fileInput = document.getElementById('question-file');
                const file = fileInput.files[0];
                
                if (!file) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Oops!',
                        text: 'Pilih file Excel terlebih dahulu!',
                        timer: 3000
                    });
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const sheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[sheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                        
                        let importedQuestions = [];
                        
                        // Skip header row (index 0)
                        for (let i = 1; i < jsonData.length; i++) {
                            const row = jsonData[i];
                            if (row.length >= 6 && row[0]) { // At least question + 4 options + correct answer
                                const question = {
                                    question: row[0].toString().trim(),
                                    options: [
                                        row[1] ? row[1].toString().trim() : '',
                                        row[2] ? row[2].toString().trim() : '',
                                        row[3] ? row[3].toString().trim() : '',
                                        row[4] ? row[4].toString().trim() : ''
                                    ],
                                    correct: this.parseCorrectAnswer(row[5]),
                                    category: row[6] ? row[6].toString().trim() : 'Umum',
                                    language: row[7] ? row[7].toString().trim() : 'indonesia'
                                };
                                
                                // Validate question has all required fields
                                if (question.question && question.options.every(opt => opt) && question.correct !== -1) {
                                    importedQuestions.push(question);
                                }
                            }
                        }
                        
                        if (importedQuestions.length > 0) {
                            // Replace existing questions with imported ones
                            this.questions = importedQuestions;
                            this.updateQuestionCount();
                            this.updateQuestionPreview();
                            
                            console.log('Questions imported:', this.questions.length);
                            console.log('Sample question:', this.questions[0]);
                            
                            Swal.fire({
                                icon: 'success',
                                title: 'Berhasil!',
                                text: `${importedQuestions.length} soal berhasil diimport dari Excel!`,
                                timer: 3000
                            });
                        } else {
                            Swal.fire({
                                icon: 'warning',
                                title: 'Tidak Ada Data!',
                                text: 'File Excel tidak berisi soal yang valid!',
                                timer: 3000
                            });
                        }
                    } catch (error) {
                        console.error('Import error:', error);
                        Swal.fire({
                            icon: 'error',
                            title: 'Error!',
                            text: 'Gagal membaca file Excel! Pastikan format sesuai template.',
                            timer: 3000
                        });
                    }
                };
                reader.readAsArrayBuffer(file);
            }
            
            parseCorrectAnswer(answer) {
                if (!answer) return -1;
                const answerStr = answer.toString().toLowerCase().trim();
                
                // Support multiple formats: A, a, 1, 0
                if (answerStr === 'a' || answerStr === '1' || answerStr === '0') return 0;
                if (answerStr === 'b' || answerStr === '2' || answerStr === '1') return 1;
                if (answerStr === 'c' || answerStr === '3' || answerStr === '2') return 2;
                if (answerStr === 'd' || answerStr === '4' || answerStr === '3') return 3;
                
                return -1; // Invalid
            }
            
            downloadTemplate() {
                // Create sample data for template
                const templateData = [
                    ['Pertanyaan', 'Opsi A', 'Opsi B', 'Opsi C', 'Opsi D', 'Jawaban Benar', 'Kategori', 'Bahasa'],
                    ['Apa ibu kota Indonesia?', 'Jakarta', 'Surabaya', 'Bandung', 'Medan', 'A', 'Geografi', 'indonesia'],
                    ['Berapa hasil dari 7 × 8?', '54', '56', '58', '52', 'B', 'Matematika', 'indonesia'],
                    ['كم عدد الصلوات في اليوم؟', 'ثلاث', 'أربع', 'خمس', 'ست', 'C', 'Agama', 'arabic'],
                    ['What color do you get when you mix red and blue?', 'Green', 'Purple', 'Orange', 'Yellow', 'B', 'Science', 'english'],
                    ['Apa arti المسجد ?', 'Rumah', 'Masjid', 'Sekolah', 'Pasar', 'B', 'Bahasa Arab', 'mixed'],
                    ['Siapa penemu telepon?', 'Edison', 'Alexander Bell', 'Tesla', 'Einstein', 'B', 'Sejarah', 'indonesia'],
                    ['ما هو أكبر كوكب في النظام الشمسي؟', 'الأرض', 'المشتري', 'زحل', 'المريخ', 'B', 'Sains', 'arabic'],
                    ['How many days are there in a week?', '6', '7', '8', '5', 'B', 'General', 'english']
                ];
                
                // Create workbook and worksheet
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.aoa_to_sheet(templateData);
                
                // Set column widths
                ws['!cols'] = [
                    { wch: 40 }, // Question
                    { wch: 20 }, // Option A
                    { wch: 20 }, // Option B
                    { wch: 20 }, // Option C
                    { wch: 20 }, // Option D
                    { wch: 15 }, // Correct Answer
                    { wch: 15 }, // Category
                    { wch: 12 }  // Language
                ];
                
                XLSX.utils.book_append_sheet(wb, ws, 'Soal Game Show');
                
                // Download file
                XLSX.writeFile(wb, 'Template_Soal_Game_Show.xlsx');
                
                Swal.fire({
                    icon: 'success',
                    title: 'Template Downloaded!',
                    text: 'File template Excel telah didownload. Isi soal sesuai format lalu import kembali.',
                    timer: 4000
                });
            }
            
            containsArabic(text) {
                const arabicRegex = /[\u0600-\u06FF\u0750-\u077F]/;
                return arabicRegex.test(text);
            }
            
            addManualQuestion() {
                const question = document.getElementById('manual-question').value.trim();
                const optionA = document.getElementById('manual-a').value.trim();
                const optionB = document.getElementById('manual-b').value.trim();
                const optionC = document.getElementById('manual-c').value.trim();
                const optionD = document.getElementById('manual-d').value.trim();
                const correct = document.getElementById('manual-correct').value;
                const language = document.getElementById('manual-language').value;
                
                if (!question || !optionA || !optionB || !optionC || !optionD || !correct) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'Lengkapi Data!',
                        text: 'Semua field harus diisi!',
                        timer: 3000
                    });
                    return;
                }
                
                const newQuestion = {
                    question: question,
                    options: [optionA, optionB, optionC, optionD],
                    correct: ['a', 'b', 'c', 'd'].indexOf(correct),
                    language: language
                };
                
                this.questions.push(newQuestion);
                this.updateQuestionCount();
                this.updateQuestionPreview();
                
                // Questions saved locally
                
                // Clear form
                document.getElementById('manual-question').value = '';
                document.getElementById('manual-a').value = '';
                document.getElementById('manual-b').value = '';
                document.getElementById('manual-c').value = '';
                document.getElementById('manual-d').value = '';
                document.getElementById('manual-correct').value = '';
                
                Swal.fire({
                    icon: 'success',
                    title: 'Berhasil!',
                    text: 'Soal berhasil ditambahkan!',
                    timer: 3000
                });
                
                this.checkStartButton();
            }
            
            updateQuestionCount() {
                this.questionCountElement.textContent = this.questions.length;
                
                // Update info text
                const infoElement = document.getElementById('question-info');
                if (this.questions.length > 0) {
                    infoElement.textContent = `Tersedia ${this.questions.length} soal. Pilih berapa soal yang akan dimainkan.`;
                } else {
                    infoElement.textContent = 'Pilih jumlah soal yang akan dimainkan di bawah';
                }
                
                this.checkStartButton();
            }
            
            updateQuestionPreview() {
                const preview = this.questions.slice(-5).map((q, index) => 
                    `<div class="mb-2 p-2 bg-gray-100 rounded">
                        <strong>${this.questions.length - 4 + index}.</strong> 
                        ${q.question.substring(0, 50)}${q.question.length > 50 ? '...' : ''}
                        <span class="text-xs text-gray-500 ml-2">(${q.language})</span>
                    </div>`
                ).join('');
                
                this.questionPreview.innerHTML = preview;
            }
            
            startGame() {
                console.log('Starting game with questions:', this.questions.length);
                
                // Get team names
                const nameInputs = document.querySelectorAll('.team-name-input');
                this.teams = Array.from(nameInputs).map((input, index) => ({
                    id: index,
                    name: input.value.trim() || `Tim ${index + 1}`,
                    score: 0,
                    color: this.teamColors[index]
                }));
                
                console.log('Teams created:', this.teams.length);
                
                // SELECT RANDOM QUESTIONS based on user selection
                let gameQuestions = [...this.questions]; // Copy all questions
                console.log('Available questions before shuffle:', gameQuestions.length);
                
                gameQuestions = this.shuffleArray(gameQuestions); // Shuffle all questions
                
                // Take only selected number of questions (or less if not enough available)
                const maxGameQuestions = Math.min(this.totalQuestions, gameQuestions.length);
                this.gameQuestions = gameQuestions.slice(0, maxGameQuestions);
                
                console.log('Game questions selected:', this.gameQuestions.length);
                console.log('First game question:', this.gameQuestions[0]);
                
                // Shuffle options for each selected question
                this.gameQuestions.forEach(question => {
                    this.shuffleQuestionOptions(question);
                });
                
                this.currentTeamIndex = 0;
                this.currentQuestionIndex = 0;
                this.gameActive = true;
                
                console.log('Game initialized - Starting question index:', this.currentQuestionIndex);
                
                this.showScreen('game');
                this.createTeamScoreboards();
                this.showQuestion();
                this.createConfetti();
                
                Swal.fire({
                    icon: 'success',
                    title: 'Game Dimulai!',
                    text: `${this.gameQuestions.length} soal acak telah dipilih! Selamat bermain!`,
                    timer: 2000
                });
            }
            
            shuffleArray(array) {
                const shuffled = [...array];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                return shuffled;
            }
            
            shuffleQuestionOptions(question) {
                // Store the correct answer text before shuffling
                const correctAnswerText = question.options[question.correct];
                
                // Create array of options with their original indices
                const optionsWithIndex = question.options.map((option, index) => ({
                    text: option,
                    originalIndex: index
                }));
                
                // Shuffle the options
                for (let i = optionsWithIndex.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [optionsWithIndex[i], optionsWithIndex[j]] = [optionsWithIndex[j], optionsWithIndex[i]];
                }
                
                // Update the question with shuffled options
                question.options = optionsWithIndex.map(item => item.text);
                
                // Find the new position of the correct answer
                question.correct = question.options.findIndex(option => option === correctAnswerText);
            }
            
            createTeamScoreboards() {
                this.teamScoresContainer.innerHTML = '';
                
                this.teams.forEach((team, index) => {
                    const div = document.createElement('div');
                    div.className = `${team.color} rounded-lg p-2 text-center shadow-lg text-white`;
                    div.innerHTML = `
                        <div class="font-bold text-xs mb-1">${team.name}</div>
                        <div class="text-xl font-black team-score" data-team="${team.id}">0</div>
                        <div class="text-xs opacity-75">poin</div>
                    `;
                    this.teamScoresContainer.appendChild(div);
                });
            }
            
            showQuestion() {
                console.log('showQuestion called - Index:', this.currentQuestionIndex, 'Total:', this.gameQuestions.length);
                
                if (this.currentQuestionIndex >= this.gameQuestions.length) {
                    console.log('No more questions - ending game');
                    this.endGame();
                    return;
                }
                
                const question = this.gameQuestions[this.currentQuestionIndex];
                console.log('Showing question:', question.question);
                
                this.currentQuestionNumber.textContent = this.currentQuestionIndex + 1;
                
                // Update total questions display
                document.getElementById('total-questions-display').textContent = this.gameQuestions.length;
                
                // Update progress bar
                const progress = ((this.currentQuestionIndex) / this.gameQuestions.length) * 100;
                document.getElementById('progress-bar').style.width = progress + '%';
                document.getElementById('progress-text').textContent = Math.round(progress) + '% Selesai';
                
                // Apply appropriate font - always LTR for mixed text
                this.questionText.className = 'text-3xl font-bold text-gray-800 leading-relaxed min-h-[100px] flex items-center justify-center';
                this.questionText.style.direction = 'ltr';
                
                // Add Arabic font class if question contains Arabic text
                if (this.containsArabic(question.question)) {
                    this.questionText.classList.add('arabic-font');
                }
                
                this.questionText.textContent = question.question;
                
                // Reset team answers for new question
                this.teamAnswers = {};
                this.answeredTeams = new Set();
                
                // Create CERDAS CERMAT team answer buttons
                this.questionOptions.innerHTML = '';
                
                // Create team answer grid
                const teamGrid = document.createElement('div');
                teamGrid.className = 'grid gap-4 mb-6';
                teamGrid.style.gridTemplateColumns = `repeat(${this.teams.length}, 1fr)`;
                
                this.teams.forEach((team, teamIndex) => {
                    const teamCard = document.createElement('div');
                    teamCard.className = `${team.color} rounded-xl p-4 text-center text-white shadow-lg`;
                    teamCard.innerHTML = `
                        <h3 class="font-bold text-lg mb-3">${team.name}</h3>
                        <div class="grid grid-cols-2 gap-2">
                            ${['A', 'B', 'C', 'D'].map((letter, optionIndex) => `
                                <button class="team-answer-btn bg-white/20 hover:bg-white/30 text-white font-bold py-2 px-3 rounded-lg transition-all duration-300 transform hover:scale-105" 
                                        data-team="${teamIndex}" data-option="${optionIndex}">
                                    ${letter}
                                </button>
                            `).join('')}
                        </div>
                        <div class="mt-3 text-sm opacity-75" id="team-status-${teamIndex}">
                            Menunggu jawaban...
                        </div>
                    `;
                    teamGrid.appendChild(teamCard);
                });
                
                this.questionOptions.appendChild(teamGrid);
                
                // Add answer options display
                const optionsDisplay = document.createElement('div');
                optionsDisplay.className = 'bg-white/90 rounded-xl p-6 mt-4';
                optionsDisplay.innerHTML = `
                    <h4 class="font-bold text-lg mb-4 text-center text-gray-800">Pilihan Jawaban:</h4>
                    <div class="grid grid-cols-2 gap-4">
                        ${question.options.map((option, index) => `
                            <div class="flex items-center gap-3 p-3 bg-gray-100 rounded-lg">
                                <div class="bg-blue-500 text-white font-bold w-8 h-8 rounded-full flex items-center justify-center">
                                    ${['A', 'B', 'C', 'D'][index]}
                                </div>
                                <span class="font-medium ${this.containsArabic(option) ? 'arabic-font' : ''}">${option}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
                this.questionOptions.appendChild(optionsDisplay);
                
                // Bind team answer events
                document.querySelectorAll('.team-answer-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const teamIndex = parseInt(e.target.dataset.team);
                        const optionIndex = parseInt(e.target.dataset.option);
                        this.submitTeamAnswer(teamIndex, optionIndex);
                    });
                });
                
                this.updateCurrentTeam();
                this.startQuestionTimer();
            }
            
            updateCurrentTeam() {
                // In CERDAS CERMAT mode, show "SEMUA TIM" instead of specific team
                this.currentTeamElement.textContent = "SEMUA TIM SIAP!";
                
                // Remove individual team highlighting since all teams can answer
                document.querySelectorAll('.team-score').forEach((scoreEl, index) => {
                    const teamCard = scoreEl.closest('div');
                    teamCard.classList.remove('ring-4', 'ring-yellow-300', 'scale-110', 'z-10');
                });
            }
            
            submitTeamAnswer(teamIndex, optionIndex) {
                // Prevent team from answering twice
                if (this.answeredTeams.has(teamIndex)) {
                    return;
                }
                
                // Record team's answer
                this.teamAnswers[teamIndex] = {
                    option: optionIndex,
                    timestamp: Date.now()
                };
                this.answeredTeams.add(teamIndex);
                
                // Update team's answer buttons visual state
                const teamCard = document.querySelector(`[data-team="${teamIndex}"]`).closest('div');
                const answerButtons = teamCard.querySelectorAll('.team-answer-btn');
                
                answerButtons.forEach((btn, index) => {
                    if (index === optionIndex) {
                        btn.classList.remove('bg-white/20', 'hover:bg-white/30');
                        btn.classList.add('bg-yellow-400', 'text-black', 'font-black', 'ring-4', 'ring-white');
                        btn.innerHTML = `${['A', 'B', 'C', 'D'][index]} ✓`;
                    } else {
                        btn.disabled = true;
                        btn.classList.add('opacity-50');
                    }
                });
                
                // Update team status
                const statusElement = document.getElementById(`team-status-${teamIndex}`);
                statusElement.textContent = `Jawaban: ${['A', 'B', 'C', 'D'][optionIndex]} ✓`;
                statusElement.classList.add('font-bold');
                
                // Add visual feedback
                teamCard.classList.add('ring-4', 'ring-yellow-300', 'scale-105');
                
                // Play sound effect
                this.playSound('correct');
                
                // Check if all teams have answered or time is up
                if (this.answeredTeams.size === this.teams.length) {
                    // All teams answered - evaluate immediately
                    setTimeout(() => {
                        this.evaluateAllAnswers();
                    }, 1000);
                }
            }
            
            evaluateAllAnswers() {
                clearInterval(this.questionTimer);
                this.timerDisplay.classList.add('hidden');
                
                const question = this.gameQuestions[this.currentQuestionIndex];
                const correctAnswer = question.correct;
                
                // Disable all remaining buttons
                document.querySelectorAll('.team-answer-btn').forEach(btn => {
                    btn.disabled = true;
                });
                
                // Evaluate each team's answer
                const results = [];
                
                this.teams.forEach((team, teamIndex) => {
                    const teamAnswer = this.teamAnswers[teamIndex];
                    let result = {
                        team: team,
                        teamIndex: teamIndex,
                        answered: !!teamAnswer,
                        correct: false,
                        points: 0
                    };
                    
                    if (teamAnswer) {
                        result.correct = teamAnswer.option === correctAnswer;
                        result.timestamp = teamAnswer.timestamp;
                        
                        if (result.correct) {
                            result.points = 100;
                            team.score += 100;
                            this.stats.correct++;
                        } else {
                            result.points = -50;
                            team.score = Math.max(0, team.score - 50);
                            this.stats.wrong++;
                        }
                    } else {
                        // Team didn't answer
                        result.points = -50;
                        team.score = Math.max(0, team.score - 50);
                        this.stats.timeout++;
                    }
                    
                    results.push(result);
                });
                
                // Sort by correctness first, then by timestamp for correct answers
                const correctAnswers = results.filter(r => r.correct).sort((a, b) => a.timestamp - b.timestamp);
                const wrongAnswers = results.filter(r => !r.correct);
                
                // Show results with animations
                this.showCerdasCermatResults(correctAnswers, wrongAnswers, question);
                
                // Update scores
                this.updateTeamScores();
                
                // Move to next question after showing results
                setTimeout(() => {
                    this.nextQuestion();
                }, 5000);
            }
            
            showCerdasCermatResults(correctAnswers, wrongAnswers, question) {
                // Create results overlay
                const resultsOverlay = document.createElement('div');
                resultsOverlay.className = 'fixed inset-0 bg-black/80 flex items-center justify-center z-50';
                resultsOverlay.innerHTML = `
                    <div class="bg-white rounded-3xl p-8 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                        <h2 class="text-3xl font-bold text-center mb-6 text-purple-800">
                            📊 HASIL JAWABAN 📊
                        </h2>
                        
                        <div class="mb-6 p-4 bg-green-100 rounded-xl">
                            <h3 class="font-bold text-lg mb-2 text-green-800">✅ Jawaban Benar: ${question.options[question.correct]}</h3>
                        </div>
                        
                        ${correctAnswers.length > 0 ? `
                            <div class="mb-6">
                                <h3 class="text-xl font-bold mb-4 text-green-600">🎉 TIM YANG BENAR:</h3>
                                <div class="space-y-3">
                                    ${correctAnswers.map((result, index) => `
                                        <div class="flex items-center justify-between p-4 bg-green-100 rounded-xl">
                                            <div class="flex items-center gap-4">
                                                <span class="text-2xl">${index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : '✅'}</span>
                                                <span class="font-bold text-lg">${result.team.name}</span>
                                                ${index === 0 ? '<span class="bg-yellow-400 text-black px-2 py-1 rounded-full text-sm font-bold">TERCEPAT!</span>' : ''}
                                            </div>
                                            <span class="text-green-600 font-bold text-xl">+100 poin</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        ${wrongAnswers.length > 0 ? `
                            <div class="mb-6">
                                <h3 class="text-xl font-bold mb-4 text-red-600">❌ TIM YANG SALAH/TIDAK JAWAB:</h3>
                                <div class="space-y-3">
                                    ${wrongAnswers.map(result => `
                                        <div class="flex items-center justify-between p-4 bg-red-100 rounded-xl">
                                            <div class="flex items-center gap-4">
                                                <span class="text-2xl">❌</span>
                                                <span class="font-bold text-lg">${result.team.name}</span>
                                                <span class="text-sm text-gray-600">
                                                    ${result.answered ? `Jawab: ${['A', 'B', 'C', 'D'][this.teamAnswers[result.teamIndex].option]}` : 'Tidak menjawab'}
                                                </span>
                                            </div>
                                            <span class="text-red-600 font-bold text-xl">-50 poin</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        <div class="text-center">
                            <div class="text-lg font-bold text-gray-600">Soal berikutnya dalam 5 detik...</div>
                            <div class="mt-4">
                                <div class="bg-blue-500 text-white px-6 py-2 rounded-full inline-block">
                                    Soal ${this.currentQuestionIndex + 1} dari ${this.gameQuestions.length}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(resultsOverlay);
                
                // Play appropriate sound
                if (correctAnswers.length > 0) {
                    this.playSound('correct');
                    this.createCelebrationEffect();
                } else {
                    this.playSound('wrong');
                }
                
                // Remove overlay after 5 seconds
                setTimeout(() => {
                    resultsOverlay.remove();
                }, 5000);
            }
            
            startQuestionTimer() {
                this.timeLeft = 30;
                this.timerDisplay.classList.remove('hidden');
                this.updateQuestionTimer();
                
                this.questionTimer = setInterval(() => {
                    if (!this.gamePaused) {
                        this.timeLeft--;
                        this.updateQuestionTimer();
                        
                        if (this.timeLeft <= 0) {
                            this.timeUp();
                        }
                    }
                }, 1000);
            }
            
            updateQuestionTimer() {
                this.questionTimerElement.textContent = this.timeLeft;
                
                // Update timer colors based on time left
                this.timerDisplay.classList.remove('bg-red-500', 'bg-orange-500', 'bg-green-500');
                
                if (this.timeLeft <= 5) {
                    this.timerDisplay.classList.add('bg-red-500', 'animate-pulse');
                } else if (this.timeLeft <= 10) {
                    this.timerDisplay.classList.add('bg-orange-500');
                    this.timerDisplay.classList.remove('animate-pulse');
                } else {
                    this.timerDisplay.classList.add('bg-green-500');
                    this.timerDisplay.classList.remove('animate-pulse');
                }
            }
            
            // selectAnswer function removed - now using CERDAS CERMAT mode with submitTeamAnswer
            
            timeUp() {
                if (!this.gameActive) return;
                
                // In CERDAS CERMAT mode, evaluate all answers when time is up
                this.evaluateAllAnswers();
            }
            
            nextQuestion() {
                console.log('nextQuestion called - Current index:', this.currentQuestionIndex, 'Total questions:', this.gameQuestions.length);
                
                // Clean up previous question animations and styles
                document.querySelectorAll('.sparkle').forEach(sparkle => sparkle.remove());
                document.querySelectorAll('.confetti').forEach(confetti => confetti.remove());
                
                // Move to next question (no team rotation in CERDAS CERMAT)
                this.currentQuestionIndex++;
                
                console.log('Moving to question index:', this.currentQuestionIndex);
                
                if (this.currentQuestionIndex < this.gameQuestions.length) {
                    console.log('Showing next question');
                    this.showQuestion();
                } else {
                    console.log('Game ended - no more questions');
                    this.endGame();
                }
            }
            
            // Scoreboard is always visible now
            
            showScoreAnimation(scoreText, teamId, color) {
                const teamCard = document.querySelector(`[data-team="${teamId}"]`).closest('div');
                const rect = teamCard.getBoundingClientRect();
                
                const scorePopup = document.createElement('div');
                scorePopup.textContent = scoreText;
                scorePopup.style.position = 'fixed';
                scorePopup.style.left = (rect.left + rect.width / 2) + 'px';
                scorePopup.style.top = rect.top + 'px';
                scorePopup.style.fontSize = '2rem';
                scorePopup.style.fontWeight = 'bold';
                scorePopup.style.color = color;
                scorePopup.style.textShadow = '2px 2px 4px rgba(0,0,0,0.5)';
                scorePopup.style.pointerEvents = 'none';
                scorePopup.style.zIndex = '9999';
                scorePopup.style.transform = 'translateX(-50%)';
                scorePopup.classList.add('score-fly');
                
                document.body.appendChild(scorePopup);
                
                setTimeout(() => {
                    scorePopup.remove();
                }, 1500);
            }
            
            updateTeamScores() {
                this.teams.forEach(team => {
                    const scoreElement = document.querySelector(`[data-team="${team.id}"]`);
                    if (scoreElement) {
                        scoreElement.textContent = team.score;
                        scoreElement.classList.add('bounce-in');
                        
                        // Highlight current team's score update
                        if (team.id === this.currentTeamIndex) {
                            const teamCard = scoreElement.closest('div');
                            teamCard.classList.add('pulse-glow');
                            setTimeout(() => {
                                teamCard.classList.remove('pulse-glow');
                            }, 2000);
                        }
                        
                        setTimeout(() => scoreElement.classList.remove('bounce-in'), 800);
                    }
                });
            }
            
            playSound(type) {
                try {
                    if (this.sounds[type]) {
                        this.sounds[type].currentTime = 0; // Reset to beginning
                        this.sounds[type].play().catch(error => {
                            console.log('Sound play failed:', error);
                        });
                    }
                } catch (error) {
                    console.log('Sound error:', error);
                }
            }
            
            addSparkleEffect(element) {
                const rect = element.getBoundingClientRect();
                for (let i = 0; i < 8; i++) {
                    setTimeout(() => {
                        const sparkle = document.createElement('div');
                        sparkle.innerHTML = '✨';
                        sparkle.style.position = 'fixed';
                        sparkle.style.left = (rect.left + Math.random() * rect.width) + 'px';
                        sparkle.style.top = (rect.top + Math.random() * rect.height) + 'px';
                        sparkle.style.fontSize = '20px';
                        sparkle.style.pointerEvents = 'none';
                        sparkle.style.zIndex = '9999';
                        sparkle.classList.add('sparkle');
                        document.body.appendChild(sparkle);
                        
                        setTimeout(() => {
                            sparkle.remove();
                        }, 2000);
                    }, i * 100);
                }
            }
            
            createCelebrationEffect() {
                // Create confetti
                for (let i = 0; i < 50; i++) {
                    setTimeout(() => {
                        const confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.style.left = Math.random() * 100 + 'vw';
                        confetti.style.backgroundColor = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3'][Math.floor(Math.random() * 6)];
                        confetti.style.animationDelay = Math.random() * 2 + 's';
                        document.body.appendChild(confetti);
                        
                        setTimeout(() => {
                            confetti.remove();
                        }, 3000);
                    }, i * 50);
                }
            }
            
            createConfetti() {
                setInterval(() => {
                    if (this.gameActive) {
                        const confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.style.left = Math.random() * 100 + 'vw';
                        confetti.style.backgroundColor = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3'][Math.floor(Math.random() * 6)];
                        document.body.appendChild(confetti);
                        
                        setTimeout(() => {
                            confetti.remove();
                        }, 3000);
                    }
                }, 2000);
            }
            
            endGame() {
                this.gameActive = false;
                // Game ended
                this.showScreen('results');
                
                // Sort teams by score
                const sortedTeams = [...this.teams].sort((a, b) => b.score - a.score);
                
                this.finalRankingsElement.innerHTML = '';
                sortedTeams.forEach((team, index) => {
                    const div = document.createElement('div');
                    let rankEmoji = '';
                    let rankClass = '';
                    
                    if (index === 0) {
                        rankEmoji = '🥇';
                        rankClass = 'pulse-glow';
                    } else if (index === 1) {
                        rankEmoji = '🥈';
                    } else if (index === 2) {
                        rankEmoji = '🥉';
                    } else {
                        rankEmoji = `${index + 1}.`;
                    }
                    
                    div.className = `${team.color} rounded-2xl p-8 flex justify-between items-center ${rankClass} transform hover:scale-105 transition-all duration-300`;
                    div.innerHTML = `
                        <div class="flex items-center gap-6">
                            <span class="text-5xl">${rankEmoji}</span>
                            <span class="text-3xl font-bold text-white game-font">${team.name}</span>
                        </div>
                        <span class="text-4xl font-black text-white">${team.score} poin</span>
                    `;
                    this.finalRankingsElement.appendChild(div);
                });
                
                // Celebration for winner
                if (sortedTeams.length > 0) {
                    Swal.fire({
                        icon: 'success',
                        title: `🕌 !مبارك ${sortedTeams[0].name} 🕌`,
                        text: `Juara Gebyar Maulid Nabi dengan ${sortedTeams[0].score} poin! بارك الله فيكم`,
                        confirmButtonText: 'OK',
                        confirmButtonColor: '#10b981'
                    });
                    
                    this.createCelebrationEffect();
                }
            }
            
            exportResults() {
                const sortedTeams = [...this.teams].sort((a, b) => b.score - a.score);
                const results = {
                    timestamp: new Date().toISOString(),
                    totalQuestions: this.currentQuestionIndex,
                    teams: sortedTeams
                };
                
                const dataStr = JSON.stringify(results, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `game-show-results-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                Swal.fire({
                    icon: 'success',
                    title: 'Hasil Diexport!',
                    text: 'File hasil game telah didownload!',
                    timer: 3000
                });
            }
            
            updateGameStats() {
                document.getElementById('correct-answers').textContent = this.stats.correct;
                document.getElementById('wrong-answers').textContent = this.stats.wrong;
                document.getElementById('timeout-answers').textContent = this.stats.timeout;
            }
            
            pauseGame() {
                if (this.gamePaused) {
                    // Resume game
                    this.gamePaused = false;
                    this.startQuestionTimer();
                    document.getElementById('pause-game-btn').innerHTML = '<i class="fas fa-pause"></i> Jeda Game';
                    
                    Swal.fire({
                        icon: 'info',
                        title: 'Game Dilanjutkan!',
                        timer: 3000
                    });
                } else {
                    // Pause game
                    this.gamePaused = true;
                    clearInterval(this.questionTimer);
                    document.getElementById('pause-game-btn').innerHTML = '<i class="fas fa-play"></i> Lanjutkan';
                    
                    Swal.fire({
                        icon: 'info',
                        title: 'Game Dijeda',
                        text: 'Klik "Lanjutkan" untuk melanjutkan game',
                        timer: 3000
                    });
                }
            }
            
            skipQuestion() {
                Swal.fire({
                    title: 'Lewati Soal?',
                    text: 'Soal ini akan dilewati tanpa poin',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonColor: '#f59e0b',
                    cancelButtonColor: '#6b7280',
                    confirmButtonText: 'Ya, Lewati',
                    cancelButtonText: 'Batal'
                }).then((result) => {
                    if (result.isConfirmed) {
                        clearInterval(this.questionTimer);
                        this.nextQuestion();
                    }
                });
            }
            
            confirmEndGame() {
                Swal.fire({
                    title: 'Akhiri Game?',
                    text: 'Game akan berakhir dan hasil akan ditampilkan',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#ef4444',
                    cancelButtonColor: '#6b7280',
                    confirmButtonText: 'Ya, Akhiri',
                    cancelButtonText: 'Batal'
                }).then((result) => {
                    if (result.isConfirmed) {
                        this.endGame();
                    }
                });
            }
            
            restartGame() {
                Swal.fire({
                    title: 'Mulai Game Baru?',
                    text: 'Semua progress akan hilang!',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Ya, Mulai Baru!',
                    cancelButtonText: 'Batal'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Starting new game
                        this.showScreen('setup');
                        this.teams = [];
                        this.currentQuestionIndex = 0;
                        this.currentTeamIndex = 0;
                        this.stats = { correct: 0, wrong: 0, timeout: 0 };
                        clearInterval(this.questionTimer);
                    }
                });
            }
            
            showScreen(screen) {
                this.setupScreen.classList.add('hidden');
                this.gameScreen.classList.add('hidden');
                this.resultsScreen.classList.add('hidden');
                
                if (screen === 'setup') {
                    this.setupScreen.classList.remove('hidden');
                } else if (screen === 'game') {
                    this.gameScreen.classList.remove('hidden');
                } else if (screen === 'results') {
                    this.resultsScreen.classList.remove('hidden');
                }
            }
        }
        
        // Global functions for HTML onclick events
        function importQuestions() {
            game.importQuestions();
        }
        
        function addManualQuestion() {
            game.addManualQuestion();
        }
        
        function downloadTemplate() {
            game.downloadTemplate();
        }
        
        // Initialize game when page loads
        let game;
        document.addEventListener('DOMContentLoaded', () => {
            game = new GameShow();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97c7f4ebc673fd6d',t:'MTc1NzQzNDIzNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
