<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎯 JEOPARDY MAULID NABI 🎯</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Nunito:wght@400;600;700;800;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #1a237e 0%, #3949ab 50%, #5c6bc0 100%);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .jeopardy-header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #0d47a1, #1976d2);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 3px solid #ffd700;
        }

        .jeopardy-logo {
            font-family: 'Fredoka One', cursive;
            font-size: 3.5rem;
            color: #ffd700;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            margin-bottom: 10px;
            letter-spacing: 3px;
        }

        .jeopardy-subtitle {
            font-size: 1.4rem;
            color: white;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        /* Scoreboard */
        .scoreboard {
            background: linear-gradient(135deg, #0d47a1, #1565c0);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            border: 2px solid #ffd700;
        }

        .scoreboard-title {
            text-align: center;
            font-family: 'Fredoka One', cursive;
            font-size: 1.8rem;
            color: #ffd700;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .teams-scores {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .team-score-card {
            background: linear-gradient(135deg, #1976d2, #1565c0);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 3px solid transparent;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .team-score-card.active {
            border-color: #ffd700;
            background: linear-gradient(135deg, #ffd700, #ffeb3b);
            color: #0d47a1;
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(255,215,0,0.4);
        }

        .team-name {
            font-family: 'Fredoka One', cursive;
            font-size: 1.3rem;
            margin-bottom: 10px;
        }

        .team-score {
            font-family: 'Fredoka One', cursive;
            font-size: 2.5rem;
            font-weight: 900;
        }

        /* Jeopardy Board */
        .jeopardy-board {
            background: linear-gradient(135deg, #0d47a1, #1565c0);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
            border: 3px solid #ffd700;
            margin-bottom: 30px;
        }

        .categories-header {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .category-title {
            background: linear-gradient(135deg, #ffd700, #ffeb3b);
            color: #0d47a1;
            padding: 20px 10px;
            text-align: center;
            font-family: 'Fredoka One', cursive;
            font-size: 1.1rem;
            font-weight: 900;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 2px solid #0d47a1;
        }

        .questions-board {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        .question-tile {
            background: linear-gradient(135deg, #1976d2, #1565c0);
            color: #ffd700;
            border: 3px solid #ffd700;
            border-radius: 8px;
            padding: 25px 15px;
            text-align: center;
            font-family: 'Fredoka One', cursive;
            font-size: 2rem;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .question-tile:hover {
            transform: scale(1.05);
            background: linear-gradient(135deg, #ffd700, #ffeb3b);
            color: #0d47a1;
            box-shadow: 0 10px 30px rgba(255,215,0,0.5);
        }

        .question-tile.answered {
            background: linear-gradient(135deg, #424242, #616161);
            color: #9e9e9e;
            cursor: not-allowed;
            border-color: #616161;
        }

        .question-tile.answered:hover {
            transform: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        /* Question Modal */
        .question-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .question-content {
            background: linear-gradient(135deg, #0d47a1, #1565c0);
            border: 5px solid #ffd700;
            border-radius: 20px;
            padding: 50px;
            width: 1200px;
            max-width: 90vw;
            max-height: 90vh;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { transform: scale(0.8) translateY(-50px); opacity: 0; }
            to { transform: scale(1) translateY(0); opacity: 1; }
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .question-info {
            background: #ffd700;
            color: #0d47a1;
            padding: 15px 25px;
            border-radius: 25px;
            font-family: 'Fredoka One', cursive;
            font-size: 1.5rem;
            font-weight: 900;
        }

        .timer-display {
            background: linear-gradient(135deg, #ff5722, #f44336);
            color: white;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Fredoka One', cursive;
            font-size: 2rem;
            font-weight: 900;
            border: 4px solid white;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .timer-display.warning {
            background: linear-gradient(135deg, #ff1744, #d50000);
            animation: shake 0.5s infinite;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .question-text {
            font-family: 'Fredoka One', cursive;
            font-size: 3rem;
            color: #ffd700;
            margin-bottom: 50px;
            line-height: 1.3;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
        }

        .answers-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        .answer-option {
            background: linear-gradient(135deg, #1976d2, #1565c0);
            color: white;
            border: 3px solid #ffd700;
            border-radius: 15px;
            padding: 30px 20px;
            font-size: 1.5rem;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .answer-option:hover {
            background: linear-gradient(135deg, #ffd700, #ffeb3b);
            color: #0d47a1;
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(255,215,0,0.4);
        }

        .answer-option.correct {
            background: linear-gradient(135deg, #4caf50, #388e3c) !important;
            border-color: white !important;
            animation: correctPulse 0.6s ease 3;
        }

        .answer-option.wrong {
            background: linear-gradient(135deg, #f44336, #d32f2f) !important;
            border-color: white !important;
            animation: wrongShake 0.6s ease 2;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Setup Screen */
        .setup-screen {
            background: linear-gradient(135deg, rgba(13,71,161,0.95), rgba(21,101,192,0.95));
            border-radius: 20px;
            padding: 50px;
            text-align: center;
            border: 3px solid #ffd700;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
        }

        .setup-title {
            font-family: 'Fredoka One', cursive;
            font-size: 3rem;
            color: #ffd700;
            margin-bottom: 30px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
        }

        .team-setup {
            margin: 40px 0;
        }

        .team-count-selector {
            background: rgba(255,215,0,0.1);
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .team-count-selector label {
            font-family: 'Fredoka One', cursive;
            font-size: 1.5rem;
            color: #ffd700;
            margin-right: 20px;
        }

        .team-count-selector select {
            padding: 12px 20px;
            font-size: 1.2rem;
            border: none;
            border-radius: 10px;
            background: #ffd700;
            color: #0d47a1;
            font-weight: 800;
            cursor: pointer;
        }

        .teams-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .team-input-card {
            background: rgba(255,215,0,0.1);
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 25px;
        }

        .team-input-card h3 {
            font-family: 'Fredoka One', cursive;
            color: #ffd700;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .team-input {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            text-align: center;
            font-weight: 700;
            background: white;
            color: #0d47a1;
        }

        .jeopardy-btn {
            background: linear-gradient(135deg, #ffd700, #ffeb3b);
            color: #0d47a1;
            border: none;
            padding: 20px 40px;
            border-radius: 25px;
            font-family: 'Fredoka One', cursive;
            font-size: 1.4rem;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(255,215,0,0.3);
            border: 3px solid #0d47a1;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 10px;
        }

        .jeopardy-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(255,215,0,0.5);
            background: linear-gradient(135deg, #ffeb3b, #ffd700);
        }

        .jeopardy-btn.secondary {
            background: linear-gradient(135deg, #1976d2, #1565c0);
            color: white;
            border-color: #ffd700;
        }

        .jeopardy-btn.secondary:hover {
            background: linear-gradient(135deg, #1565c0, #1976d2);
        }

        /* Import Section */
        .import-section {
            background: rgba(255,215,0,0.1);
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }

        .import-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        /* Results Screen */
        .results-screen {
            background: linear-gradient(135deg, rgba(13,71,161,0.95), rgba(21,101,192,0.95));
            border-radius: 20px;
            padding: 50px;
            text-align: center;
            border: 3px solid #ffd700;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
        }

        .winner-announcement {
            margin-bottom: 40px;
        }

        .winner-title {
            font-family: 'Fredoka One', cursive;
            font-size: 4rem;
            color: #ffd700;
            margin-bottom: 20px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            animation: winnerGlow 2s ease-in-out infinite;
        }

        @keyframes winnerGlow {
            0%, 100% { text-shadow: 3px 3px 6px rgba(0,0,0,0.5); }
            50% { text-shadow: 0 0 20px #ffd700, 3px 3px 6px rgba(0,0,0,0.5); }
        }

        .final-scores {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .final-score-card {
            background: linear-gradient(135deg, #1976d2, #1565c0);
            border: 3px solid #ffd700;
            border-radius: 15px;
            padding: 30px;
            color: white;
        }

        .final-score-card.winner {
            background: linear-gradient(135deg, #ffd700, #ffeb3b);
            color: #0d47a1;
            transform: scale(1.1);
            box-shadow: 0 15px 40px rgba(255,215,0,0.5);
        }

        .final-team-name {
            font-family: 'Fredoka One', cursive;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .final-team-score {
            font-family: 'Fredoka One', cursive;
            font-size: 3rem;
            font-weight: 900;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .jeopardy-logo {
                font-size: 2.5rem;
            }
            
            .categories-header,
            .questions-board {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .category-title {
                font-size: 0.9rem;
                padding: 15px 8px;
            }
            
            .question-tile {
                font-size: 1.5rem;
                padding: 20px 10px;
                min-height: 70px;
            }
            
            .question-text {
                font-size: 2rem;
            }
            
            .answers-grid {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none !important;
        }

        /* Message overlay */
        .message-overlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Fredoka One', cursive;
            font-size: 4rem;
            font-weight: 900;
            z-index: 10000;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            animation: messageAppear 0.5s ease;
        }

        @keyframes messageAppear {
            from { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .message-overlay.correct { color: #4caf50; }
        .message-overlay.wrong { color: #f44336; }
        .message-overlay.timeout { color: #ff9800; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="jeopardy-header">
            <h1 class="jeopardy-logo">JEOPARDY!</h1>
            <p class="jeopardy-subtitle">🕌 EDISI MAULID NABI MUHAMMAD SAW 🕌</p>
        </div>

        <!-- Setup Screen -->
        <div id="setupScreen" class="setup-screen">
            <h2 class="setup-title">🎯 PERSIAPAN JEOPARDY 🎯</h2>
            
            <!-- Import Section -->
            <div class="import-section">
                <h3 style="font-family: 'Fredoka One', cursive; color: #ffd700; font-size: 1.8rem; margin-bottom: 20px;">📚 Import Soal Quiz</h3>
                <div class="import-buttons">
                    <button class="jeopardy-btn secondary" onclick="downloadTemplate()">
                        📥 Download Template Excel
                    </button>
                    <label for="excelFile" class="jeopardy-btn">
                        📤 Import Soal Excel
                        <input type="file" id="excelFile" style="display: none;" accept=".xlsx,.xls" onchange="importExcel(event)">
                    </label>
                </div>
                <div style="font-size: 1rem; color: white; margin-top: 15px; line-height: 1.5;">
                    <strong>Format Excel (Jeopardy):</strong> Kolom A=Petunjuk (bukan pertanyaan), B-E=Jawaban dalam bentuk pertanyaan (dimulai "Apa/Siapa"), F=Jawaban Benar (A/B/C/D), G=Kategori, H=Poin
                </div>
            </div>
            
            <div class="team-setup">
                <div class="team-count-selector">
                    <label>👥 Jumlah Tim:</label>
                    <select id="teamCount" onchange="updateTeamSetup()">
                        <option value="2">2 Tim</option>
                        <option value="3" selected>3 Tim</option>
                        <option value="4">4 Tim</option>
                        <option value="5">5 Tim</option>
                    </select>
                </div>

                <div class="teams-grid" id="teamsGrid">
                    <!-- Team inputs will be generated here -->
                </div>
            </div>

            <button class="jeopardy-btn" onclick="startJeopardy()">
                🚀 MULAI JEOPARDY!
            </button>
        </div>

        <!-- Rules Screen -->
        <div id="rulesScreen" class="setup-screen hidden">
            <h2 class="setup-title">📋 ATURAN MAIN JEOPARDY 📋</h2>
            
            <div style="background: rgba(255,215,0,0.1); border: 2px solid #ffd700; border-radius: 15px; padding: 30px; margin: 30px 0; text-align: left;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px;">
                    <div>
                        <h3 style="font-family: 'Fredoka One', cursive; color: #ffd700; font-size: 1.5rem; margin-bottom: 15px;">🎯 ATURAN UTAMA JEOPARDY:</h3>
                        <ul style="font-size: 1.1rem; line-height: 1.8; color: white;">
                            <li>• <strong>Jawab dalam bentuk PERTANYAAN!</strong></li>
                            <li>• Mulai jawaban dengan "Apa" atau "Siapa"</li>
                            <li>• Contoh: "Siapa Muhammad SAW?" bukan "Muhammad SAW"</li>
                            <li>• Tim bergantian memilih kategori dan nilai poin</li>
                            <li>• Semakin tinggi poin, semakin sulit petunjuknya</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h3 style="font-family: 'Fredoka One', cursive; color: #ffd700; font-size: 1.5rem; margin-bottom: 15px;">⏰ SISTEM WAKTU:</h3>
                        <ul style="font-size: 1.1rem; line-height: 1.8; color: white;">
                            <li>• Setiap petunjuk memiliki batas waktu 30 detik</li>
                            <li>• Timer akan berubah merah saat tersisa 10 detik</li>
                            <li>• Jika waktu habis, tidak ada poin yang didapat</li>
                            <li>• Giliran otomatis pindah ke tim berikutnya</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h3 style="font-family: 'Fredoka One', cursive; color: #ffd700; font-size: 1.5rem; margin-bottom: 15px;">🏆 SISTEM POIN:</h3>
                        <ul style="font-size: 1.1rem; line-height: 1.8; color: white;">
                            <li>• <strong>Jawaban benar:</strong> Dapat poin sesuai nilai</li>
                            <li>• <strong>Jawaban salah:</strong> Poin dikurangi!</li>
                            <li>• <strong>Daily Double:</strong> Bisa bertaruh poin</li>
                            <li>• <strong>Final Jeopardy:</strong> Taruhan terakhir menentukan juara</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h3 style="font-family: 'Fredoka One', cursive; color: #ffd700; font-size: 1.5rem; margin-bottom: 15px;">🎮 FITUR KHUSUS:</h3>
                        <ul style="font-size: 1.1rem; line-height: 1.8; color: white;">
                            <li>• <strong>Daily Double:</strong> Petunjuk tersembunyi untuk bertaruh</li>
                            <li>• <strong>Double Jeopardy:</strong> Babak dengan poin lebih tinggi</li>
                            <li>• <strong>Final Jeopardy:</strong> Semua tim bertaruh untuk kemenangan</li>
                            <li>• Strategi penting: pilih kategori yang dikuasai!</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div style="background: rgba(255,69,0,0.1); border: 2px solid #ff4500; border-radius: 15px; padding: 25px; margin: 30px 0;">
                <h3 style="font-family: 'Fredoka One', cursive; color: #ff4500; font-size: 1.4rem; margin-bottom: 15px; text-align: center;">⚠️ PENTING UNTUK DIINGAT!</h3>
                <div style="font-size: 1.1rem; line-height: 1.6; color: white; text-align: center;">
                    <p>🔄 <strong>Soal dan jawaban diacak setiap permainan</strong> - Jadi setiap game akan berbeda!</p>
                    <p>📱 <strong>Game ini responsif</strong> - Bisa dimainkan di HP, tablet, atau komputer</p>
                    <p>🎯 <strong>Total 25 soal</strong> - 5 kategori × 5 tingkat kesulitan</p>
                </div>
            </div>

            <div style="text-align: center; margin-top: 40px;">
                <button class="jeopardy-btn" onclick="startActualGame()">
                    🚀 MULAI BERMAIN SEKARANG!
                </button>
                <button class="jeopardy-btn secondary" onclick="backToSetup()">
                    ⬅️ KEMBALI KE PENGATURAN
                </button>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="hidden">
            <!-- Scoreboard -->
            <div class="scoreboard">
                <h3 class="scoreboard-title">📊 PAPAN SKOR</h3>
                <div class="teams-scores" id="teamsScores">
                    <!-- Team scores will be populated here -->
                </div>
            </div>

            <!-- Jeopardy Board -->
            <div class="jeopardy-board">
                <div class="categories-header" id="categoriesHeader">
                    <!-- Categories will be populated here -->
                </div>
                <div class="questions-board" id="questionsBoard">
                    <!-- Question tiles will be populated here -->
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="jeopardy-btn secondary" onclick="endJeopardy()">
                    🏁 SELESAI JEOPARDY
                </button>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="resultsScreen" class="results-screen hidden">
            <div class="winner-announcement">
                <h2 class="winner-title" id="winnerTitle">🏆 JUARA JEOPARDY! 🏆</h2>
            </div>

            <div class="final-scores" id="finalScores">
                <!-- Final scores will be populated here -->
            </div>

            <div style="margin: 40px 0; font-size: 1.3rem; line-height: 1.6;">
                <p>🌟 Semoga ilmu yang telah dipelajari bermanfaat</p>
                <p>dan menjadi amal jariyah bagi kita semua 🌟</p>
                <p style="margin-top: 20px; font-weight: 900; font-size: 1.5rem;">بارك الله فيكم</p>
            </div>

            <button class="jeopardy-btn" onclick="restartJeopardy()">
                🔄 JEOPARDY BARU
            </button>
        </div>
    </div>

    <!-- Question Modal (will be created dynamically) -->

    <!-- Include SheetJS for Excel processing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        // Game state
        let teams = [];
        let currentTeam = 0;
        let gameActive = false;
        let answeredQuestions = new Set();
        let timeLeft = 30;
        let timer;
        let importedQuestions = [];
        let gameQuestions = {};
        let dailyDoubleUsed = false;
        let finalJeopardyActive = false;
        let gameRound = 1; // 1 = Jeopardy, 2 = Double Jeopardy, 3 = Final Jeopardy

        // Sound effects
        const sounds = {
            rightAnswer: new Audio('https://archive.org/download/jeopardy_202509/rightanswer.mp3'),
            wrongAnswer: new Audio('https://archive.org/download/jeopardy_202509/jeopardy-incorrect-answer.mp3'),
            dailyDouble: new Audio('https://archive.org/download/jeopardy_202509/jeopardy-daily-double-sound-effect-from-youtube_76mCCAq.mp3'),
            timesUp: new Audio('https://archive.org/download/jeopardy_202509/times-up_AN8OlqZ.mp3'),
            fillingBoard: new Audio('https://archive.org/download/jeopardy_202509/jeopardy-filling-board.mp3')
        };

        // Preload and configure sounds
        Object.values(sounds).forEach(sound => {
            sound.preload = 'auto';
            sound.volume = 0.7;
        });

        // Play sound function
        function playSound(soundName) {
            try {
                const sound = sounds[soundName];
                if (sound) {
                    sound.currentTime = 0;
                    sound.play().catch(e => console.log('Sound play failed:', e));
                }
            } catch (error) {
                console.log('Sound error:', error);
            }
        }

        // Jeopardy categories and clues (format Jeopardy asli - petunjuk, bukan pertanyaan)
        const jeopardyData = {
            "SEJARAH NABI": [
                { question: "Nama ayah Nabi Muhammad SAW ini", answers: ["Siapa Abdullah?", "Siapa Abu Thalib?", "Siapa Abdul Muthalib?", "Siapa Abu Bakar?"], correct: 0, points: 100 },
                { question: "Kota kelahiran Nabi Muhammad SAW", answers: ["Apa Madinah?", "Apa Makkah?", "Apa Thaif?", "Apa Yaman?"], correct: 1, points: 200 },
                { question: "Nama ibu Nabi Muhammad SAW", answers: ["Siapa Khadijah?", "Siapa Aisyah?", "Siapa Aminah?", "Siapa Fatimah?"], correct: 2, points: 300 },
                { question: "Usia Nabi Muhammad SAW saat diangkat menjadi Rasul", answers: ["Apa 35 tahun?", "Apa 40 tahun?", "Apa 45 tahun?", "Apa 50 tahun?"], correct: 1, points: 400 },
                { question: "Orang yang merawat Nabi Muhammad SAW setelah ibunya wafat", answers: ["Siapa Abu Thalib?", "Siapa Abdul Muthalib?", "Siapa Halimah As-Sa'diyah?", "Siapa Abu Bakar?"], correct: 1, points: 500 }
            ],
            "AL-QURAN": [
                { question: "Jumlah surat dalam Al-Qur'an", answers: ["Apa 112?", "Apa 113?", "Apa 114?", "Apa 115?"], correct: 2, points: 100 },
                { question: "Nama surat pertama dalam Al-Qur'an", answers: ["Apa Al-Baqarah?", "Apa Al-Fatihah?", "Apa An-Nas?", "Apa Al-Falaq?"], correct: 1, points: 200 },
                { question: "Jumlah ayat dalam surat Al-Fatihah", answers: ["Apa 5 ayat?", "Apa 6 ayat?", "Apa 7 ayat?", "Apa 8 ayat?"], correct: 2, points: 300 },
                { question: "Nama surat terakhir dalam Al-Qur'an", answers: ["Apa Al-Falaq?", "Apa An-Nas?", "Apa Al-Ikhlas?", "Apa Al-Kafirun?"], correct: 1, points: 400 },
                { question: "Surat yang disebut 'Ummul Qur'an'", answers: ["Apa Al-Baqarah?", "Apa Al-Fatihah?", "Apa Al-Ikhlas?", "Apa Yasin?"], correct: 1, points: 500 }
            ],
            "SAHABAT": [
                { question: "Sahabat pertama yang masuk Islam", answers: ["Siapa Umar bin Khattab?", "Siapa Utsman bin Affan?", "Siapa Ali bin Abi Thalib?", "Siapa Abu Bakar Ash-Shiddiq?"], correct: 3, points: 100 },
                { question: "Sahabat yang dijuluki 'Al-Faruq'", answers: ["Siapa Abu Bakar?", "Siapa Umar bin Khattab?", "Siapa Utsman bin Affan?", "Siapa Ali bin Abi Thalib?"], correct: 1, points: 200 },
                { question: "Sahabat yang dijuluki 'Dzun Nurayn'", answers: ["Siapa Abu Bakar?", "Siapa Umar bin Khattab?", "Siapa Utsman bin Affan?", "Siapa Ali bin Abi Thalib?"], correct: 2, points: 300 },
                { question: "Sahabat yang paling banyak meriwayatkan hadits", answers: ["Siapa Abu Bakar?", "Siapa Umar bin Khattab?", "Siapa Abu Hurairah?", "Siapa Ali bin Abi Thalib?"], correct: 2, points: 400 },
                { question: "Sahabat yang dijuluki 'Sayful Allah Al-Maslul'", answers: ["Siapa Khalid bin Walid?", "Siapa Sa'd bin Abi Waqqas?", "Siapa Amr bin Ash?", "Siapa Abu Ubaidah?"], correct: 0, points: 500 }
            ],
            "RUKUN ISLAM": [
                { question: "Jumlah rukun Islam", answers: ["Apa 4?", "Apa 5?", "Apa 6?", "Apa 7?"], correct: 1, points: 100 },
                { question: "Rukun Islam yang pertama", answers: ["Apa Shalat?", "Apa Syahadat?", "Apa Zakat?", "Apa Puasa?"], correct: 1, points: 200 },
                { question: "Jumlah shalat wajib dalam sehari", answers: ["Apa 3 kali?", "Apa 4 kali?", "Apa 5 kali?", "Apa 6 kali?"], correct: 2, points: 300 },
                { question: "Bulan pelaksanaan puasa wajib bagi umat Islam", answers: ["Apa Rajab?", "Apa Sya'ban?", "Apa Ramadhan?", "Apa Syawal?"], correct: 2, points: 400 },
                { question: "Kota tempat menunaikan ibadah haji", answers: ["Apa Madinah?", "Apa Makkah?", "Apa Yerusalem?", "Apa Baghdad?"], correct: 1, points: 500 }
            ],
            "AKHLAK": [
                { question: "Sifat terpuji yang harus dimiliki seorang Muslim", answers: ["Apa Sombong?", "Apa Jujur?", "Apa Marah?", "Apa Iri?"], correct: 1, points: 100 },
                { question: "Cara berbakti kepada orang tua menurut Islam", answers: ["Apa Membantah?", "Apa Menuruti semua keinginan?", "Apa Berbuat baik dan patuh?", "Apa Mengabaikan?"], correct: 2, points: 200 },
                { question: "Yang harus dilakukan ketika bertemu dengan orang lain", answers: ["Apa Mengabaikan?", "Apa Mengucapkan salam?", "Apa Berlari?", "Apa Bersembunyi?"], correct: 1, points: 300 },
                { question: "Ajaran Islam tentang bertetangga", answers: ["Apa Acuh tak acuh?", "Apa Berbuat baik?", "Apa Mengganggu?", "Apa Menghindari?"], correct: 1, points: 400 },
                { question: "Ajaran Islam tentang kebersihan", answers: ["Apa Tidak penting?", "Apa Sebagian dari iman?", "Apa Hanya untuk orang kaya?", "Apa Pilihan?"], correct: 1, points: 500 }
            ]
        };

        // Default team names
        const defaultTeamNames = ['🌟 Tim Sahabat', '⭐ Tim Tabi\'in', '✨ Tim Salafus Shalih', '🎯 Tim Muhajirin', '🏆 Tim Anshar'];

        // Download Excel template
        function downloadTemplate() {
            const templateData = [
                ['Petunjuk (Clue)', 'Jawaban A', 'Jawaban B', 'Jawaban C', 'Jawaban D', 'Jawaban Benar', 'Kategori', 'Poin'],
                ['Nama ayah Nabi Muhammad SAW ini', 'Siapa Abdullah?', 'Siapa Abu Thalib?', 'Siapa Abdul Muthalib?', 'Siapa Abu Bakar?', 'A', 'SEJARAH NABI', '100'],
                ['Kota kelahiran Nabi Muhammad SAW', 'Apa Madinah?', 'Apa Makkah?', 'Apa Thaif?', 'Apa Yaman?', 'B', 'SEJARAH NABI', '200'],
                ['Jumlah surat dalam Al-Qur\'an', 'Apa 112?', 'Apa 113?', 'Apa 114?', 'Apa 115?', 'C', 'AL-QURAN', '300'],
                ['Sahabat pertama yang masuk Islam', 'Siapa Umar bin Khattab?', 'Siapa Utsman bin Affan?', 'Siapa Ali bin Abi Thalib?', 'Siapa Abu Bakar Ash-Shiddiq?', 'D', 'SAHABAT', '400'],
                ['Jumlah rukun Islam', 'Apa 4?', 'Apa 5?', 'Apa 6?', 'Apa 7?', 'B', 'RUKUN ISLAM', '500']
            ];

            const ws = XLSX.utils.aoa_to_sheet(templateData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Template Soal Jeopardy');
            
            // Set column widths
            ws['!cols'] = [
                {wch: 50}, {wch: 20}, {wch: 20}, {wch: 20}, {wch: 20}, {wch: 15}, {wch: 15}, {wch: 10}
            ];

            XLSX.writeFile(wb, 'Template_Soal_Jeopardy_Maulid.xlsx');
        }

        // Import Excel file
        function importExcel(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});

                    // Skip header row
                    const questionsData = jsonData.slice(1);
                    importedQuestions = [];

                    questionsData.forEach((row, index) => {
                        if (row.length >= 7 && row[0]) {
                            const correctAnswerLetter = row[5]?.toString().toUpperCase();
                            let correctIndex = 0;
                            
                            switch(correctAnswerLetter) {
                                case 'A': correctIndex = 0; break;
                                case 'B': correctIndex = 1; break;
                                case 'C': correctIndex = 2; break;
                                case 'D': correctIndex = 3; break;
                                default: correctIndex = 0;
                            }

                            importedQuestions.push({
                                question: row[0],
                                answers: [row[1], row[2], row[3], row[4]],
                                correct: correctIndex,
                                category: row[6] || 'UMUM',
                                points: parseInt(row[7]) || 100
                            });
                        }
                    });

                    if (importedQuestions.length > 0) {
                        // Count questions by category
                        const categoryCount = {};
                        importedQuestions.forEach(q => {
                            categoryCount[q.category] = (categoryCount[q.category] || 0) + 1;
                        });
                        
                        let countInfo = Object.entries(categoryCount)
                            .map(([cat, count]) => `${cat}: ${count} soal`)
                            .join('\n');
                        
                        showMessage(`✅ Berhasil import ${importedQuestions.length} soal!\n\nRincian per kategori:\n${countInfo}`, 'correct');
                    } else {
                        showMessage('❌ Tidak ada soal valid yang ditemukan. Periksa format Excel Anda.', 'wrong');
                    }

                } catch (error) {
                    showMessage('❌ Error membaca file Excel. Pastikan format file benar.', 'wrong');
                    console.error('Excel import error:', error);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // Initialize team setup
        function updateTeamSetup() {
            const teamCount = parseInt(document.getElementById('teamCount').value);
            const teamsGrid = document.getElementById('teamsGrid');
            teamsGrid.innerHTML = '';

            for (let i = 0; i < teamCount; i++) {
                const teamCard = document.createElement('div');
                teamCard.className = 'team-input-card';
                teamCard.innerHTML = `
                    <h3>👥 Tim ${i + 1}</h3>
                    <input type="text" class="team-input" id="team${i + 1}Name" 
                           placeholder="Nama Tim ${i + 1}" value="${defaultTeamNames[i] || `Tim ${i + 1}`}">
                `;
                teamsGrid.appendChild(teamCard);
            }
        }

        // Start Jeopardy (show rules first)
        function startJeopardy() {
            const teamCount = parseInt(document.getElementById('teamCount').value);
            teams = [];
            
            for (let i = 0; i < teamCount; i++) {
                const teamName = document.getElementById(`team${i + 1}Name`).value || `Tim ${i + 1}`;
                teams.push({ name: teamName, score: 0 });
            }

            document.getElementById('setupScreen').classList.add('hidden');
            document.getElementById('rulesScreen').classList.remove('hidden');
        }

        // Start actual game after rules
        function startActualGame() {
            // Prepare randomized questions
            prepareGameQuestions();

            document.getElementById('rulesScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            
            currentTeam = 0;
            gameActive = true;
            answeredQuestions.clear();
            
            createJeopardyBoard();
            updateScoreboard();
            
            showMessage('🎉 JEOPARDY DIMULAI! 🎉', 'correct');
        }

        // Back to setup from rules
        function backToSetup() {
            document.getElementById('rulesScreen').classList.add('hidden');
            document.getElementById('setupScreen').classList.remove('hidden');
        }

        // Prepare game questions with randomization
        function prepareGameQuestions() {
            const questionsToUse = importedQuestions.length > 0 ? importedQuestions : Object.values(jeopardyData).flat();
            
            // Group questions by category
            const questionsByCategory = {};
            questionsToUse.forEach(q => {
                if (!questionsByCategory[q.category]) {
                    questionsByCategory[q.category] = [];
                }
                questionsByCategory[q.category].push(q);
            });
            
            // Get 5 categories (or all available if less than 5)
            const availableCategories = Object.keys(questionsByCategory);
            shuffleArray(availableCategories);
            const selectedCategories = availableCategories.slice(0, 5);
            
            // If we have less than 5 categories, use default data
            if (selectedCategories.length < 5) {
                gameQuestions = { ...jeopardyData };
            } else {
                gameQuestions = {};
                selectedCategories.forEach(category => {
                    const categoryQuestions = [...questionsByCategory[category]];
                    shuffleArray(categoryQuestions);
                    
                    // Take up to 5 questions per category, ensuring we have different point values
                    const pointValues = [100, 200, 300, 400, 500];
                    gameQuestions[category] = [];
                    
                    for (let i = 0; i < 5; i++) {
                        if (categoryQuestions[i]) {
                            const question = { ...categoryQuestions[i] };
                            question.points = pointValues[i];
                            // Shuffle answers
                            shuffleAnswers(question);
                            gameQuestions[category].push(question);
                        }
                    }
                });
            }
            
            // Shuffle answers for default questions too
            Object.keys(gameQuestions).forEach(category => {
                gameQuestions[category].forEach(question => {
                    shuffleAnswers(question);
                });
            });
        }

        // Shuffle array utility
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Shuffle answers while keeping track of correct answer
        function shuffleAnswers(question) {
            const correctAnswer = question.answers[question.correct];
            shuffleArray(question.answers);
            question.correct = question.answers.indexOf(correctAnswer);
        }

        // Create Jeopardy board
        function createJeopardyBoard() {
            const categoriesHeader = document.getElementById('categoriesHeader');
            const questionsBoard = document.getElementById('questionsBoard');
            
            categoriesHeader.innerHTML = '';
            questionsBoard.innerHTML = '';
            
            const categories = Object.keys(gameQuestions);
            
            // Play filling board sound
            playSound('fillingBoard');
            
            // Create category headers
            categories.forEach(category => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category-title';
                categoryDiv.textContent = category;
                categoriesHeader.appendChild(categoryDiv);
            });
            
            // Create question tiles
            for (let row = 0; row < 5; row++) {
                categories.forEach((category, colIndex) => {
                    const question = gameQuestions[category][row];
                    const questionTile = document.createElement('div');
                    questionTile.className = 'question-tile';
                    questionTile.textContent = `$${question.points}`;
                    questionTile.onclick = () => selectQuestion(category, row);
                    questionTile.id = `tile-${colIndex}-${row}`;
                    questionsBoard.appendChild(questionTile);
                });
            }
        }

        // Select question
        function selectQuestion(category, questionIndex) {
            const tileId = `tile-${Object.keys(gameQuestions).indexOf(category)}-${questionIndex}`;
            
            if (answeredQuestions.has(tileId)) {
                showMessage('❌ Soal sudah dijawab!', 'wrong');
                return;
            }
            
            const question = gameQuestions[category][questionIndex];
            
            // Check for Daily Double (10% chance pada soal dengan poin 300-500)
            if (!dailyDoubleUsed && question.points >= 300 && Math.random() < 0.3) {
                dailyDoubleUsed = true;
                showDailyDoubleModal(question, category, tileId);
            } else {
                showQuestionModal(question, category, tileId);
            }
        }

        // Show Daily Double modal
        function showDailyDoubleModal(question, category, tileId) {
            // Play Daily Double sound
            playSound('dailyDouble');
            
            const modal = document.createElement('div');
            modal.className = 'question-modal';
            modal.id = 'dailyDoubleModal';
            
            const currentTeamScore = teams[currentTeam].score;
            const maxBet = Math.max(currentTeamScore, 1000);
            
            // Find question index
            const questionIndex = gameQuestions[category].indexOf(question);
            
            modal.innerHTML = `
                <div class="question-content">
                    <div style="text-align: center; margin-bottom: 40px;">
                        <h2 style="font-family: 'Fredoka One', cursive; font-size: 4rem; color: #ffd700; text-shadow: 3px 3px 6px rgba(0,0,0,0.5); animation: winnerGlow 2s ease-in-out infinite;">
                            🎯 DAILY DOUBLE! 🎯
                        </h2>
                        <p style="font-size: 1.5rem; color: white; margin: 20px 0;">
                            ${teams[currentTeam].name}, Anda menemukan Daily Double!<br>
                            Berapa poin yang ingin Anda pertaruhkan?
                        </p>
                        <p style="font-size: 1.2rem; color: #ffd700;">
                            Skor saat ini: $${currentTeamScore} | Maksimal taruhan: $${maxBet}
                        </p>
                    </div>
                    
                    <div style="margin: 30px 0;">
                        <input type="number" id="betAmount" min="100" max="${maxBet}" value="500" 
                               style="width: 200px; padding: 15px; font-size: 1.5rem; text-align: center; border: 3px solid #ffd700; border-radius: 10px; background: white; color: #0d47a1; font-weight: 900;">
                    </div>
                    
                    <button class="jeopardy-btn" onclick="confirmDailyDoubleBet('${category}', ${questionIndex}, '${tileId}')">
                        💰 KONFIRMASI TARUHAN
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Confirm Daily Double bet
        function confirmDailyDoubleBet(category, questionIndex, tileId) {
            const betAmount = parseInt(document.getElementById('betAmount').value);
            const maxBet = Math.max(teams[currentTeam].score, 1000);
            
            if (betAmount < 100 || betAmount > maxBet) {
                showMessage(`❌ Taruhan harus antara $100 - $${maxBet}!`, 'wrong');
                return;
            }
            
            // Close Daily Double modal
            const modal = document.getElementById('dailyDoubleModal');
            if (modal) modal.remove();
            
            // Find the question and set bet amount
            const categories = Object.keys(gameQuestions);
            const categoryIndex = categories.indexOf(category);
            const question = gameQuestions[category][questionIndex];
            question.dailyDoubleBet = betAmount;
            
            showQuestionModal(question, category, tileId);
        }

        // Show question modal
        function showQuestionModal(question, category, tileId) {
            // Store current question data globally
            currentQuestionData = question;
            
            const modal = document.createElement('div');
            modal.className = 'question-modal';
            modal.id = 'questionModal';
            
            const displayPoints = question.dailyDoubleBet || question.points;
            
            modal.innerHTML = `
                <div class="question-content">
                    <div class="question-header">
                        <div class="question-info">${category} - $${displayPoints}${question.dailyDoubleBet ? ' (Daily Double)' : ''}</div>
                        <div class="timer-display" id="timerDisplay">30</div>
                    </div>
                    <div class="question-text">${question.question}</div>
                    <div class="answers-grid" id="answersGrid">
                        ${question.answers.map((answer, index) => 
                            `<div class="answer-option" onclick="selectAnswer(${index}, '${tileId}', ${question.points}, ${question.correct})">${answer}</div>`
                        ).join('')}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Start timer
            timeLeft = 30;
            timer = setInterval(() => {
                timeLeft--;
                const timerDisplay = document.getElementById('timerDisplay');
                if (timerDisplay) {
                    timerDisplay.textContent = timeLeft;
                    if (timeLeft <= 10) {
                        timerDisplay.classList.add('warning');
                    }
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    timeoutQuestion(tileId);
                }
            }, 1000);
        }

        // Global variable to store current question data
        let currentQuestionData = null;

        // Select answer
        function selectAnswer(selectedIndex, tileId, points, correctIndex) {
            clearInterval(timer);
            
            const answers = document.querySelectorAll('.answer-option');
            answers.forEach(answer => answer.style.pointerEvents = 'none');
            
            // Determine points (Daily Double or regular)
            const actualPoints = currentQuestionData?.dailyDoubleBet || points;
            
            if (selectedIndex === correctIndex) {
                answers[selectedIndex].classList.add('correct');
                teams[currentTeam].score += actualPoints;
                
                // Play correct answer sound
                playSound('rightAnswer');
                
                if (currentQuestionData?.dailyDoubleBet) {
                    showMessage('🎯 DAILY DOUBLE BENAR! 🎯\n💰 +$' + actualPoints + ' poin!', 'correct');
                } else {
                    showMessage('🎉 BENAR! 🎉\n💰 +$' + actualPoints + ' poin!', 'correct');
                }
                
                setTimeout(() => {
                    closeQuestionModal();
                    markQuestionAnswered(tileId);
                    updateScoreboard();
                    // Tim yang benar tetap dapat giliran
                }, 2000);
            } else {
                answers[selectedIndex].classList.add('wrong');
                
                // Play wrong answer sound
                playSound('wrongAnswer');
                
                setTimeout(() => {
                    answers[correctIndex].classList.add('correct');
                }, 500);
                
                // PENGURANGAN POIN untuk jawaban salah (aturan Jeopardy asli)
                teams[currentTeam].score -= actualPoints;
                
                if (currentQuestionData?.dailyDoubleBet) {
                    showMessage('💥 DAILY DOUBLE SALAH!\n💸 -$' + actualPoints + ' poin!', 'wrong');
                } else {
                    showMessage('❌ SALAH!\n💸 -$' + actualPoints + ' poin!', 'wrong');
                }
                
                setTimeout(() => {
                    closeQuestionModal();
                    markQuestionAnswered(tileId);
                    updateScoreboard();
                    nextTeam();
                }, 3000);
            }
        }

        // Timeout question
        function timeoutQuestion(tileId) {
            const answers = document.querySelectorAll('.answer-option');
            answers.forEach(answer => answer.style.pointerEvents = 'none');
            
            // Play times up sound
            playSound('timesUp');
            
            showMessage('⏰ WAKTU HABIS!', 'timeout');
            
            setTimeout(() => {
                closeQuestionModal();
                markQuestionAnswered(tileId);
                nextTeam();
            }, 2500);
        }

        // Close question modal
        function closeQuestionModal() {
            const modal = document.getElementById('questionModal');
            if (modal) {
                modal.remove();
            }
        }

        // Mark question as answered
        function markQuestionAnswered(tileId) {
            answeredQuestions.add(tileId);
            const tile = document.getElementById(tileId);
            if (tile) {
                tile.classList.add('answered');
                tile.onclick = null;
                tile.textContent = '✓';
            }
            
            // Check if all questions are answered
            if (answeredQuestions.size >= 25) {
                setTimeout(() => startFinalJeopardy(), 1000);
            }
        }

        // Next team
        function nextTeam() {
            currentTeam = (currentTeam + 1) % teams.length;
            updateScoreboard();
        }

        // Update scoreboard
        function updateScoreboard() {
            const teamsScores = document.getElementById('teamsScores');
            teamsScores.innerHTML = '';
            
            teams.forEach((team, index) => {
                const scoreCard = document.createElement('div');
                scoreCard.className = `team-score-card ${index === currentTeam ? 'active' : ''}`;
                scoreCard.innerHTML = `
                    <div class="team-name">${team.name}</div>
                    <div class="team-score">$${team.score}</div>
                `;
                teamsScores.appendChild(scoreCard);
            });
        }

        // Start Final Jeopardy
        function startFinalJeopardy() {
            finalJeopardyActive = true;
            
            const finalQuestion = {
                category: "SEJARAH ISLAM",
                question: "Peristiwa penting yang terjadi pada tahun 622 M ini menandai dimulainya kalender Hijriah",
                answer: "Apa Hijrah Nabi Muhammad SAW ke Madinah?"
            };
            
            showFinalJeopardyModal(finalQuestion);
        }

        // Show Final Jeopardy modal
        function showFinalJeopardyModal(finalQuestion) {
            const modal = document.createElement('div');
            modal.className = 'question-modal';
            modal.id = 'finalJeopardyModal';
            
            modal.innerHTML = `
                <div class="question-content">
                    <div style="text-align: center; margin-bottom: 40px;">
                        <h2 style="font-family: 'Fredoka One', cursive; font-size: 4rem; color: #ffd700; text-shadow: 3px 3px 6px rgba(0,0,0,0.5); animation: winnerGlow 2s ease-in-out infinite;">
                            🏆 FINAL JEOPARDY! 🏆
                        </h2>
                        <p style="font-size: 1.8rem; color: white; margin: 20px 0; font-weight: 700;">
                            Kategori: ${finalQuestion.category}
                        </p>
                        <p style="font-size: 1.3rem; color: #ffd700;">
                            Semua tim harus memasang taruhan sebelum melihat petunjuk!
                        </p>
                    </div>
                    
                    <div id="bettingPhase">
                        <div style="background: rgba(255,215,0,0.1); border: 2px solid #ffd700; border-radius: 15px; padding: 30px; margin: 20px 0;">
                            <h3 style="color: #ffd700; font-family: 'Fredoka One', cursive; font-size: 1.5rem; margin-bottom: 20px;">
                                💰 FASE TARUHAN
                            </h3>
                            <div id="teamBets"></div>
                        </div>
                        <button class="jeopardy-btn" onclick="showFinalClue()">
                            📜 LIHAT PETUNJUK FINAL
                        </button>
                    </div>
                    
                    <div id="answerPhase" style="display: none;">
                        <div style="font-size: 2.5rem; color: #ffd700; margin: 30px 0; font-family: 'Fredoka One', cursive;">
                            ${finalQuestion.question}
                        </div>
                        <p style="font-size: 1.2rem; color: white; margin: 20px 0;">
                            Jawaban yang benar: <strong style="color: #ffd700;">${finalQuestion.answer}</strong>
                        </p>
                        <button class="jeopardy-btn" onclick="calculateFinalScores()">
                            🏁 HITUNG SKOR FINAL
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            createBettingInterface();
        }

        // Create betting interface for Final Jeopardy
        function createBettingInterface() {
            const teamBetsDiv = document.getElementById('teamBets');
            teamBetsDiv.innerHTML = '';
            
            teams.forEach((team, index) => {
                const maxBet = Math.max(team.score, 0);
                const teamBetDiv = document.createElement('div');
                teamBetDiv.style.cssText = 'margin: 15px 0; padding: 20px; background: rgba(25,118,210,0.3); border-radius: 10px; border: 2px solid #1976d2;';
                
                teamBetDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                        <div style="font-family: 'Fredoka One', cursive; font-size: 1.2rem; color: white; min-width: 150px;">
                            ${team.name}
                        </div>
                        <div style="color: #ffd700; font-weight: 700;">
                            Skor: $${team.score}
                        </div>
                        <div>
                            <label style="color: white; margin-right: 10px;">Taruhan:</label>
                            <input type="number" id="finalBet${index}" min="0" max="${maxBet}" value="${Math.min(maxBet, 500)}" 
                                   style="width: 120px; padding: 8px; border: 2px solid #ffd700; border-radius: 5px; text-align: center; font-weight: 700;">
                        </div>
                        <div style="color: #ffd700; font-size: 0.9rem;">
                            Max: $${maxBet}
                        </div>
                    </div>
                `;
                
                teamBetsDiv.appendChild(teamBetDiv);
            });
        }

        // Show final clue
        function showFinalClue() {
            // Collect all bets
            teams.forEach((team, index) => {
                const betInput = document.getElementById(`finalBet${index}`);
                team.finalBet = parseInt(betInput.value) || 0;
            });
            
            document.getElementById('bettingPhase').style.display = 'none';
            document.getElementById('answerPhase').style.display = 'block';
        }

        // Calculate final scores
        function calculateFinalScores() {
            // For demo purposes, randomly determine who got it right
            // In real game, this would be based on actual answers
            teams.forEach(team => {
                const gotItRight = Math.random() > 0.5; // 50% chance
                if (gotItRight) {
                    team.score += team.finalBet;
                } else {
                    team.score -= team.finalBet;
                }
            });
            
            const modal = document.getElementById('finalJeopardyModal');
            if (modal) modal.remove();
            
            endJeopardy();
        }

        // End Jeopardy
        function endJeopardy() {
            gameActive = false;
            clearInterval(timer);
            
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.remove('hidden');
            
            const sortedTeams = [...teams].sort((a, b) => b.score - a.score);
            const winner = sortedTeams[0];
            
            document.getElementById('winnerTitle').textContent = `🏆 ${winner.name} JUARA! 🏆`;
            
            const finalScores = document.getElementById('finalScores');
            finalScores.innerHTML = '';
            
            sortedTeams.forEach((team, index) => {
                const scoreCard = document.createElement('div');
                scoreCard.className = `final-score-card ${index === 0 ? 'winner' : ''}`;
                scoreCard.innerHTML = `
                    <div class="final-team-name">${index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : '🏅'} ${team.name}</div>
                    <div class="final-team-score">$${team.score}</div>
                `;
                finalScores.appendChild(scoreCard);
            });
        }

        // Restart Jeopardy
        function restartJeopardy() {
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('rulesScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('setupScreen').classList.remove('hidden');
            
            // Reset game state
            teams = [];
            currentTeam = 0;
            gameActive = false;
            answeredQuestions.clear();
            clearInterval(timer);
            gameQuestions = {};
            dailyDoubleUsed = false;
            finalJeopardyActive = false;
            gameRound = 1;
            
            // Reset file input
            document.getElementById('excelFile').value = '';
            
            updateTeamSetup();
        }

        // Show message
        function showMessage(message, type) {
            // Remove existing message if any
            const existingMessage = document.querySelector('.message-overlay');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            const messageEl = document.createElement('div');
            messageEl.className = `message-overlay ${type}`;
            
            // Handle multi-line messages
            if (message.includes('\n')) {
                const lines = message.split('\n');
                messageEl.innerHTML = lines.map(line => `<div>${line}</div>`).join('');
            } else {
                messageEl.textContent = message;
            }
            
            document.body.appendChild(messageEl);
            
            setTimeout(() => {
                if (messageEl.parentNode) {
                    messageEl.remove();
                }
            }, 2500);
        }

        // Make functions globally accessible
        window.selectAnswer = selectAnswer;
        window.confirmDailyDoubleBet = confirmDailyDoubleBet;
        window.showFinalClue = showFinalClue;
        window.calculateFinalScores = calculateFinalScores;
        window.downloadTemplate = downloadTemplate;
        window.importExcel = importExcel;
        window.updateTeamSetup = updateTeamSetup;
        window.startJeopardy = startJeopardy;
        window.startActualGame = startActualGame;
        window.backToSetup = backToSetup;
        window.endJeopardy = endJeopardy;
        window.restartJeopardy = restartJeopardy;

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateTeamSetup();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97c74a45d252fce4',t:'MTc1NzQyNzI0Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
